(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,54385,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}},43173,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let s=e.r(90571),i=s.__importDefault(e.r(6085)),n=s.__importDefault(e.r(54385));r.default=class{throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,r,s,i;let a=null,o=null,l=null,c=e.status,u=e.statusText;if(e.ok){if("HEAD"!==this.method){let r=await e.text();""===r||(o="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null==(t=this.headers.get("Accept"))?void 0:t.includes("application/vnd.pgrst.plan+text"))?r:JSON.parse(r))}let i=null==(r=this.headers.get("Prefer"))?void 0:r.match(/count=(exact|planned|estimated)/),n=null==(s=e.headers.get("content-range"))?void 0:s.split("/");i&&n&&n.length>1&&(l=parseInt(n[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(a={code:"PGRST116",details:"Results contain ".concat(o.length," rows, application/vnd.pgrst.object+json requires 1 row"),hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,l=null,c=406,u="Not Acceptable"):o=1===o.length?o[0]:null)}else{let t=await e.text();try{a=JSON.parse(t),Array.isArray(a)&&404===e.status&&(o=[],a=null,c=200,u="OK")}catch(r){404===e.status&&""===t?(c=204,u="No Content"):a={message:t}}if(a&&this.isMaybeSingle&&(null==(i=null==a?void 0:a.details)?void 0:i.includes("0 rows"))&&(a=null,c=200,u="OK"),a&&this.shouldThrowOnError)throw new n.default(a)}return{error:a,data:o,count:l,status:c,statusText:u}});return this.shouldThrowOnError||(r=r.catch(e=>{var t,r,s;return{error:{message:"".concat(null!=(t=null==e?void 0:e.name)?t:"FetchError",": ").concat(null==e?void 0:e.message),details:"".concat(null!=(r=null==e?void 0:e.stack)?r:""),hint:"",code:"".concat(null!=(s=null==e?void 0:e.code)?s:"")},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!=(t=e.shouldThrowOnError)&&t,this.signal=e.signal,this.isMaybeSingle=null!=(r=e.isMaybeSingle)&&r,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=i.default:this.fetch=fetch}}},82191,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let s=e.r(90571).__importDefault(e.r(43173));class i extends s.default{select(e){let t=!1,r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e){let{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:i=s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i?"".concat(i,".order"):"order",a=this.url.searchParams.get(n);return this.url.searchParams.set(n,"".concat(a?"".concat(a,","):"").concat(e,".").concat(t?"asc":"desc").concat(void 0===r?"":r?".nullsfirst":".nullslast")),this}limit(e){let{foreignTable:t,referencedTable:r=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.url.searchParams.set(void 0===r?"limit":"".concat(r,".limit"),"".concat(e)),this}range(e,t){let{foreignTable:r,referencedTable:s=r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=void 0===s?"offset":"".concat(s,".offset"),n=void 0===s?"limit":"".concat(s,".limit");return this.url.searchParams.set(i,"".concat(e)),this.url.searchParams.set(n,"".concat(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain(){var e;let{analyze:t=!1,verbose:r=!1,settings:s=!1,buffers:i=!1,wal:n=!1,format:a="text"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=[t?"analyze":null,r?"verbose":null,s?"settings":null,i?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!=(e=this.headers.get("Accept"))?e:"application/json";return this.headers.set("Accept","application/vnd.pgrst.plan+".concat(a,'; for="').concat(l,'"; options=').concat(o,";")),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer","max-affected=".concat(e)),this}}r.default=i},14633,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let s=e.r(90571).__importDefault(e.r(82191));class i extends s.default{eq(e,t){return this.url.searchParams.append(e,"eq.".concat(t)),this}neq(e,t){return this.url.searchParams.append(e,"neq.".concat(t)),this}gt(e,t){return this.url.searchParams.append(e,"gt.".concat(t)),this}gte(e,t){return this.url.searchParams.append(e,"gte.".concat(t)),this}lt(e,t){return this.url.searchParams.append(e,"lt.".concat(t)),this}lte(e,t){return this.url.searchParams.append(e,"lte.".concat(t)),this}like(e,t){return this.url.searchParams.append(e,"like.".concat(t)),this}likeAllOf(e,t){return this.url.searchParams.append(e,"like(all).{".concat(t.join(","),"}")),this}likeAnyOf(e,t){return this.url.searchParams.append(e,"like(any).{".concat(t.join(","),"}")),this}ilike(e,t){return this.url.searchParams.append(e,"ilike.".concat(t)),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,"ilike(all).{".concat(t.join(","),"}")),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,"ilike(any).{".concat(t.join(","),"}")),this}is(e,t){return this.url.searchParams.append(e,"is.".concat(t)),this}in(e,t){let r=Array.from(new Set(t)).map(e=>"string"==typeof e&&RegExp("[,()]").test(e)?'"'.concat(e,'"'):"".concat(e)).join(",");return this.url.searchParams.append(e,"in.(".concat(r,")")),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,"cs.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cs.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cs.".concat(JSON.stringify(t))),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,"cd.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cd.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cd.".concat(JSON.stringify(t))),this}rangeGt(e,t){return this.url.searchParams.append(e,"sr.".concat(t)),this}rangeGte(e,t){return this.url.searchParams.append(e,"nxl.".concat(t)),this}rangeLt(e,t){return this.url.searchParams.append(e,"sl.".concat(t)),this}rangeLte(e,t){return this.url.searchParams.append(e,"nxr.".concat(t)),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,"adj.".concat(t)),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,"ov.".concat(t)):this.url.searchParams.append(e,"ov.{".concat(t.join(","),"}")),this}textSearch(e,t){let{config:r,type:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i="";return"plain"===s?i="pl":"phrase"===s?i="ph":"websearch"===s&&(i="w"),this.url.searchParams.append(e,"".concat(i,"fts").concat(void 0===r?"":"(".concat(r,")"),".").concat(t)),this}match(e){return Object.entries(e).forEach(e=>{let[t,r]=e;this.url.searchParams.append(t,"eq.".concat(r))}),this}not(e,t,r){return this.url.searchParams.append(e,"not.".concat(t,".").concat(r)),this}or(e){let{foreignTable:t,referencedTable:r=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.url.searchParams.append(r?"".concat(r,".or"):"or","(".concat(e,")")),this}filter(e,t,r){return this.url.searchParams.append(e,"".concat(t,".").concat(r)),this}}r.default=i},38290,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let s=e.r(90571).__importDefault(e.r(14633));r.default=class{select(e,t){let{head:r=!1,count:i}=null!=t?t:{},n=!1,a=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!n?"":('"'===e&&(n=!n),e)).join("");return this.url.searchParams.set("select",a),i&&this.headers.append("Prefer","count=".concat(i)),new s.default({method:r?"HEAD":"GET",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e){var t;let{count:r,defaultToNull:i=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r&&this.headers.append("Prefer","count=".concat(r)),i||this.headers.append("Prefer","missing=default"),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>'"'.concat(e,'"'));this.url.searchParams.set("columns",e.join(","))}}return new s.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!=(t=this.fetch)?t:fetch})}upsert(e){var t;let{onConflict:r,ignoreDuplicates:i=!1,count:n,defaultToNull:a=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.headers.append("Prefer","resolution=".concat(i?"ignore":"merge","-duplicates")),void 0!==r&&this.url.searchParams.set("on_conflict",r),n&&this.headers.append("Prefer","count=".concat(n)),a||this.headers.append("Prefer","missing=default"),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>'"'.concat(e,'"'));this.url.searchParams.set("columns",e.join(","))}}return new s.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!=(t=this.fetch)?t:fetch})}update(e){var t;let{count:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r&&this.headers.append("Prefer","count=".concat(r)),new s.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!=(t=this.fetch)?t:fetch})}delete(){var e;let{count:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t&&this.headers.append("Prefer","count=".concat(t)),new s.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!=(e=this.fetch)?e:fetch})}constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=s}}},2259,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let s=e.r(90571),i=s.__importDefault(e.r(38290)),n=s.__importDefault(e.r(14633));class a{from(e){let t=new URL("".concat(this.url,"/").concat(e));return new i.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new a(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e){var t;let r,s,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{head:a=!1,get:o=!1,count:l}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=new URL("".concat(this.url,"/rpc/").concat(e));a||o?(r=a?"HEAD":"GET",Object.entries(i).filter(e=>{let[t,r]=e;return void 0!==r}).map(e=>{let[t,r]=e;return[t,Array.isArray(r)?"{".concat(r.join(","),"}"):"".concat(r)]}).forEach(e=>{let[t,r]=e;c.searchParams.append(t,r)})):(r="POST",s=i);let u=new Headers(this.headers);return l&&u.set("Prefer","count=".concat(l)),new n.default({method:r,url:c,headers:u,schema:this.schemaName,body:s,fetch:null!=(t=this.fetch)?t:fetch})}constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=s}}r.default=a},82215,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PostgrestError=r.PostgrestBuilder=r.PostgrestTransformBuilder=r.PostgrestFilterBuilder=r.PostgrestQueryBuilder=r.PostgrestClient=void 0;let s=e.r(90571),i=s.__importDefault(e.r(2259));r.PostgrestClient=i.default;let n=s.__importDefault(e.r(38290));r.PostgrestQueryBuilder=n.default;let a=s.__importDefault(e.r(14633));r.PostgrestFilterBuilder=a.default;let o=s.__importDefault(e.r(82191));r.PostgrestTransformBuilder=o.default;let l=s.__importDefault(e.r(43173));r.PostgrestBuilder=l.default;let c=s.__importDefault(e.r(54385));r.PostgrestError=c.default,r.default={PostgrestClient:i.default,PostgrestQueryBuilder:n.default,PostgrestFilterBuilder:a.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:l.default,PostgrestError:c.default}},67034,(e,t,r)=>{!function(){var e={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],s=t[1];return(r+s)*3/4-s},t.toByteArray=function(e){var t,r,n=l(e),a=n[0],o=n[1],c=new i((a+o)*3/4-o),u=0,h=o>0?a-4:a;for(r=0;r<h;r+=4)t=s[e.charCodeAt(r)]<<18|s[e.charCodeAt(r+1)]<<12|s[e.charCodeAt(r+2)]<<6|s[e.charCodeAt(r+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===o&&(t=s[e.charCodeAt(r)]<<2|s[e.charCodeAt(r+1)]>>4,c[u++]=255&t),1===o&&(t=s[e.charCodeAt(r)]<<10|s[e.charCodeAt(r+1)]<<4|s[e.charCodeAt(r+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,s=e.length,i=s%3,n=[],a=0,o=s-i;a<o;a+=16383)n.push(function(e,t,s){for(var i,n=[],a=t;a<s;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),n.push(r[i>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return n.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?n.push(r[(t=e[s-1])>>2]+r[t<<4&63]+"=="):2===i&&n.push(r[(t=(e[s-2]<<8)+e[s-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),n.join("")};for(var r=[],s=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=n.length;a<o;++a)r[a]=n[a],s[n.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var s=r===t?0:4-r%4;return[r,s]}s[45]=62,s[95]=63},72:function(e,t,r){"use strict";var s=r(675),i=r(783),n="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var s=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var n=0|f(s,i),l=a(n),c=l.write(s,i);return c!==n&&(l=l.slice(0,c)),l}if(ArrayBuffer.isView(e))return h(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(R(e,ArrayBuffer)||e&&R(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(R(e,SharedArrayBuffer)||e&&R(e.buffer,SharedArrayBuffer)))return function(e,t,r){var s;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(s=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),s}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var u=e.valueOf&&e.valueOf();if(null!=u&&u!==e)return o.from(u,t,r);var p=function(e){if(o.isBuffer(e)){var t=0|d(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}(e);if(p)return p;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return c(e),a(e<0?0:0|d(e))}function h(e){for(var t=e.length<0?0:0|d(e.length),r=a(t),s=0;s<t;s+=1)r[s]=255&e[s];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(c(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return u(e)},o.allocUnsafeSlow=function(e){return u(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||R(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,s=arguments.length>2&&!0===arguments[2];if(!s&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return T(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return A(e).length;default:if(i)return s?-1:T(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,r){var i,n,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var s=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>s)&&(r=s);for(var i="",n=t;n<r;++n)i+=I[e[n]];return i}(this,t,r);case"utf8":case"utf-8":return m(this,t,r);case"ascii":return function(e,t,r){var s="";r=Math.min(e.length,r);for(var i=t;i<r;++i)s+=String.fromCharCode(127&e[i]);return s}(this,t,r);case"latin1":case"binary":return function(e,t,r){var s="";r=Math.min(e.length,r);for(var i=t;i<r;++i)s+=String.fromCharCode(e[i]);return s}(this,t,r);case"base64":return i=this,n=t,a=r,0===n&&a===i.length?s.fromByteArray(i):s.fromByteArray(i.slice(n,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var s=e.slice(t,r),i="",n=0;n<s.length;n+=2)i+=String.fromCharCode(s[n]+256*s[n+1]);return i}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function g(e,t,r){var s=e[t];e[t]=e[r],e[r]=s}function y(e,t,r,s,i){var n;if(0===e.length)return -1;if("string"==typeof r?(s=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(n=r*=1)!=n&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,s)),o.isBuffer(t))return 0===t.length?-1:w(e,t,r,s,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return w(e,[t],r,s,i)}throw TypeError("val must be string, number or Buffer")}function w(e,t,r,s,i){var n,a=1,o=e.length,l=t.length;if(void 0!==s&&("ucs2"===(s=String(s).toLowerCase())||"ucs-2"===s||"utf16le"===s||"utf-16le"===s)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var u=-1;for(n=r;n<o;n++)if(c(e,n)===c(t,-1===u?0:n-u)){if(-1===u&&(u=n),n-u+1===l)return u*a}else -1!==u&&(n-=n-u),u=-1}else for(r+l>o&&(r=o-l),n=r;n>=0;n--){for(var h=!0,d=0;d<l;d++)if(c(e,n+d)!==c(t,d)){h=!1;break}if(h)return n}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(R(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),R(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,s=t.length,i=0,n=Math.min(r,s);i<n;++i)if(e[i]!==t[i]){r=e[i],s=t[i];break}return r<s?-1:+(s<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,s=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var n=e[r];if(R(n,Uint8Array)&&(n=o.from(n)),!o.isBuffer(n))throw TypeError('"list" argument must be an Array of Buffers');n.copy(s,i),i+=n.length}return s},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?m(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},n&&(o.prototype[n]=o.prototype.inspect),o.prototype.compare=function(e,t,r,s,i){if(R(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===s&&(s=0),void 0===i&&(i=this.length),t<0||r>e.length||s<0||i>this.length)throw RangeError("out of range index");if(s>=i&&t>=r)return 0;if(s>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,s>>>=0,i>>>=0,this===e)return 0;for(var n=i-s,a=r-t,l=Math.min(n,a),c=this.slice(s,i),u=e.slice(t,r),h=0;h<l;++h)if(c[h]!==u[h]){n=c[h],a=u[h];break}return n<a?-1:+(a<n)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)};function m(e,t,r){r=Math.min(e.length,r);for(var s=[],i=t;i<r;){var n,a,o,l,c=e[i],u=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=r)switch(h){case 1:c<128&&(u=c);break;case 2:(192&(n=e[i+1]))==128&&(l=(31&c)<<6|63&n)>127&&(u=l);break;case 3:n=e[i+1],a=e[i+2],(192&n)==128&&(192&a)==128&&(l=(15&c)<<12|(63&n)<<6|63&a)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:n=e[i+1],a=e[i+2],o=e[i+3],(192&n)==128&&(192&a)==128&&(192&o)==128&&(l=(15&c)<<18|(63&n)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,s.push(u>>>10&1023|55296),u=56320|1023&u),s.push(u),i+=h}var d=s,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",g=0;g<f;)p+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return p}function b(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function _(e,t,r,s,i,n){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<n)throw RangeError('"value" argument is out of bounds');if(r+s>e.length)throw RangeError("Index out of range")}function v(e,t,r,s,i,n){if(r+s>e.length||r<0)throw RangeError("Index out of range")}function k(e,t,r,s,n){return t*=1,r>>>=0,n||v(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,s,23,4),r+4}function S(e,t,r,s,n){return t*=1,r>>>=0,n||v(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,s,52,8),r+8}o.prototype.write=function(e,t,r,s){if(void 0===t)s="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)s=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===s&&(s="utf8")):(s=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,n,a,o,l,c,u,h,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");s||(s="utf8");for(var f=!1;;)switch(s){case"hex":return function(e,t,r,s){r=Number(r)||0;var i=e.length-r;s?(s=Number(s))>i&&(s=i):s=i;var n=t.length;s>n/2&&(s=n/2);for(var a=0;a<s;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return i=t,n=r,j(T(e,this.length-i),this,i,n);case"ascii":return a=t,o=r,j(O(e),this,a,o);case"latin1":case"binary":return function(e,t,r,s){return j(O(t),e,r,s)}(this,e,t,r);case"base64":return l=t,c=r,j(A(e),this,l,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=t,h=r,j(function(e,t){for(var r,s,i=[],n=0;n<e.length&&!((t-=2)<0);++n)s=(r=e.charCodeAt(n))>>8,i.push(r%256),i.push(s);return i}(e,this.length-u),this,u,h);default:if(f)throw TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var s=this.subarray(e,t);return Object.setPrototypeOf(s,o.prototype),s},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var s=this[e],i=1,n=0;++n<t&&(i*=256);)s+=this[e+n]*i;return s},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var s=this[e+--t],i=1;t>0&&(i*=256);)s+=this[e+--t]*i;return s},o.prototype.readUInt8=function(e,t){return e>>>=0,t||b(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var s=this[e],i=1,n=0;++n<t&&(i*=256);)s+=this[e+n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var s=t,i=1,n=this[e+--s];s>0&&(i*=256);)n+=this[e+--s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readInt8=function(e,t){return(e>>>=0,t||b(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||b(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||b(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||b(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||b(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||b(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||b(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,s){if(e*=1,t>>>=0,r>>>=0,!s){var i=Math.pow(2,8*r)-1;_(this,e,t,r,i,0)}var n=1,a=0;for(this[t]=255&e;++a<r&&(n*=256);)this[t+a]=e/n&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,s){if(e*=1,t>>>=0,r>>>=0,!s){var i=Math.pow(2,8*r)-1;_(this,e,t,r,i,0)}var n=r-1,a=1;for(this[t+n]=255&e;--n>=0&&(a*=256);)this[t+n]=e/a&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,s){if(e*=1,t>>>=0,!s){var i=Math.pow(2,8*r-1);_(this,e,t,r,i-1,-i)}var n=0,a=1,o=0;for(this[t]=255&e;++n<r&&(a*=256);)e<0&&0===o&&0!==this[t+n-1]&&(o=1),this[t+n]=(e/a|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,s){if(e*=1,t>>>=0,!s){var i=Math.pow(2,8*r-1);_(this,e,t,r,i-1,-i)}var n=r-1,a=1,o=0;for(this[t+n]=255&e;--n>=0&&(a*=256);)e<0&&0===o&&0!==this[t+n+1]&&(o=1),this[t+n]=(e/a|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||_(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return k(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return k(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return S(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return S(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,s){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),s||0===s||(s=this.length),t>=e.length&&(t=e.length),t||(t=0),s>0&&s<r&&(s=r),s===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(s<0)throw RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),e.length-t<s-r&&(s=e.length-t+r);var i=s-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,s);else if(this===e&&r<t&&t<s)for(var n=i-1;n>=0;--n)e[n+t]=this[n+r];else Uint8Array.prototype.set.call(e,this.subarray(r,s),t);return i},o.prototype.fill=function(e,t,r,s){if("string"==typeof e){if("string"==typeof t?(s=t,t=0,r=this.length):"string"==typeof r&&(s=r,r=this.length),void 0!==s&&"string"!=typeof s)throw TypeError("encoding must be a string");if("string"==typeof s&&!o.isEncoding(s))throw TypeError("Unknown encoding: "+s);if(1===e.length){var i,n=e.charCodeAt(0);("utf8"===s&&n<128||"latin1"===s)&&(e=n)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,s),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%l]}return this};var E=/[^+/0-9A-Za-z-_]/g;function T(e,t){t=t||1/0;for(var r,s=e.length,i=null,n=[],a=0;a<s;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===s){(t-=3)>-1&&n.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&n.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&n.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;n.push(r)}else if(r<2048){if((t-=2)<0)break;n.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;n.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;n.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return n}function O(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function A(e){return s.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(E,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function j(e,t,r,s){for(var i=0;i<s&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function R(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var I=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var s=16*r,i=0;i<16;++i)t[s+i]=e[r]+e[i];return t}()},783:function(e,t){t.read=function(e,t,r,s,i){var n,a,o=8*i-s-1,l=(1<<o)-1,c=l>>1,u=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,n=f&(1<<-u)-1,f>>=-u,u+=o;u>0;n=256*n+e[t+h],h+=d,u-=8);for(a=n&(1<<-u)-1,n>>=-u,u+=s;u>0;a=256*a+e[t+h],h+=d,u-=8);if(0===n)n=1-c;else{if(n===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,s),n-=c}return(f?-1:1)*a*Math.pow(2,n-s)},t.write=function(e,t,r,s,i,n){var a,o,l,c=8*n-i-1,u=(1<<c)-1,h=u>>1,d=5960464477539062e-23*(23===i),f=s?0:n-1,p=s?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+h>=1?t+=d/l:t+=d*Math.pow(2,1-h),t*l>=2&&(a++,l/=2),a+h>=u?(o=0,a=u):a+h>=1?(o=(t*l-1)*Math.pow(2,i),a+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&o,f+=p,o/=256,i-=8);for(a=a<<i|o,c+=i;c>0;e[r+f]=255&a,f+=p,a/=256,c-=8);e[r+f-p]|=128*g}}},r={};function s(t){var i=r[t];if(void 0!==i)return i.exports;var n=r[t]={exports:{}},a=!0;try{e[t](n,n.exports,s),a=!1}finally{a&&delete r[t]}return n.exports}s.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=s(72)}()},4427,e=>{"use strict";function t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}e.s(["createOrder",()=>ra,"getJwelleryProducts",()=>rr,"getOrders",()=>rn,"getProducts",()=>rs],4427);class r{async findById(e){let{data:t,error:r}=await this.supabase.from(this.tableName).select("*").eq("id",e).single();if(r){if("PGRST116"===r.code)return null;throw r}return t}async findAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,{data:r,error:s}=await this.supabase.from(this.tableName).select("*").range(t,t+e-1);if(s)throw s;return r||[]}async create(e){let{data:t,error:r}=await this.supabase.from(this.tableName).insert(e).select().single();if(r)throw r;return t}async update(e,t){let{data:r,error:s}=await this.supabase.from(this.tableName).update(t).eq("id",e).select().single();if(s){if("PGRST116"===s.code)return null;throw s}return r}async delete(e){let{error:t}=await this.supabase.from(this.tableName).delete().eq("id",e);if(t)throw t;return!0}async count(){let{count:e,error:t}=await this.supabase.from(this.tableName).select("*",{count:"exact",head:!0});if(t)throw t;return e||0}constructor(e,r){t(this,"supabase",void 0),t(this,"tableName",void 0),this.supabase=e,this.tableName=r}}class s extends r{async findByEmail(e){let{data:t,error:r}=await this.supabase.from("users").select("*").eq("email",e).single();if(r){if("PGRST116"===r.code)return null;throw r}return t}async findByRole(e){let{data:t,error:r}=await this.supabase.from("users").select("*").eq("role",e).order("created_at",{ascending:!1});if(r)throw r;return t||[]}async updatePassword(e,t){let{data:r,error:s}=await this.supabase.from("users").update({password:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s){if("PGRST116"===s.code)return null;throw s}return r}async updateLastLogin(e){let{data:t,error:r}=await this.supabase.from("users").update({last_login:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e).select().single();if(r){if("PGRST116"===r.code)return null;throw r}return t}async deactivateUser(e){let{data:t,error:r}=await this.supabase.from("users").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(r){if("PGRST116"===r.code)return null;throw r}return t}async activateUser(e){let{data:t,error:r}=await this.supabase.from("users").update({is_active:!0,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(r){if("PGRST116"===r.code)return null;throw r}return t}async updateProfile(e,t){let{data:r,error:s}=await this.supabase.from("users").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s){if("PGRST116"===s.code)return null;throw s}return r}async searchUsers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,{data:r,error:s}=await this.supabase.from("users").select("*").or("email.ilike.%".concat(e,"%,first_name.ilike.%").concat(e,"%,last_name.ilike.%").concat(e,"%")).limit(t);if(s)throw s;return r||[]}async enableTwoFactor(e,t){let{data:r,error:s}=await this.supabase.from("users").update({two_factor_enabled:!0,two_factor_secret:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s){if("PGRST116"===s.code)return null;throw s}return r}async disableTwoFactor(e){let{data:t,error:r}=await this.supabase.from("users").update({two_factor_enabled:!1,two_factor_secret:null,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(r){if("PGRST116"===r.code)return null;throw r}return t}async updateTwoFactorSecret(e,t){let{data:r,error:s}=await this.supabase.from("users").update({two_factor_secret:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s){if("PGRST116"===s.code)return null;throw s}return r}constructor(e){super(e,"users")}}class i extends r{async searchGems(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,{data:r,error:s}=await this.supabase.from("gems").select("*").eq("is_active",!0).or("name.ilike.%".concat(e,"%,identification.ilike.%").concat(e,"%,origin.ilike.%").concat(e,"%")).order("created_at",{ascending:!1}).limit(t);if(s)throw s;return r||[]}async findActiveGems(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,{data:r,error:s}=await this.supabase.from("gems").select("*").eq("is_active",!0).order("created_at",{ascending:!1}).range(t,t+e-1);if(s)throw s;return r||[]}async findGemsWithFilters(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=this.supabase.from("gems").select("*").order("created_at",{ascending:!1});void 0!==e.minPrice&&(s=s.gte("price",e.minPrice)),void 0!==e.maxPrice&&(s=s.lte("price",e.maxPrice)),e.color&&(s=s.eq("color",e.color)),e.clarity&&(s=s.eq("clarity",e.clarity)),e.shape_and_cut&&(s=s.eq("shape_and_cut",e.shape_and_cut)),e.origin&&(s=s.eq("origin",e.origin)),void 0!==e.isActive&&(s=s.eq("is_active",e.isActive));let{data:i,error:n}=await s.range(r,r+t-1);if(n)throw n;return i||[]}async updateStock(e,t){let{data:r,error:s}=await this.supabase.from("gems").update({stock_quantity:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s){if("PGRST116"===s.code)return null;throw s}return r}async decreaseStock(e,t){let r=await this.findById(e);if(!r)return null;let s=Math.max(0,r.stock_quantity-t);return this.updateStock(e,s)}async increaseStock(e,t){let r=await this.findById(e);if(!r)return null;let s=r.stock_quantity+t;return this.updateStock(e,s)}async activateGem(e){let{data:t,error:r}=await this.supabase.from("gems").update({is_active:!0,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(r){if("PGRST116"===r.code)return null;throw r}return t}async deactivateGem(e){let{data:t,error:r}=await this.supabase.from("gems").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(r){if("PGRST116"===r.code)return null;throw r}return t}async getLowStockGems(e){let{data:t,error:r}=await this.supabase.from("gems").select("*").eq("is_active",!0).lte("stock_quantity",e).order("stock_quantity",{ascending:!0});if(r)throw r;return t||[]}async getPriceRange(){let{data:e,error:t}=await this.supabase.from("gems").select("price").eq("is_active",!0);if(t)throw t;if(!e||0===e.length)return{min:0,max:0};let r=e.map(e=>e.price);return{min:Math.min(...r),max:Math.max(...r)}}async bulkUpdateStock(e){let t=[];for(let r of e){let e=await this.updateStock(r.id,r.quantity);e&&t.push(e)}return t}async getGemsByIds(e){if(0===e.length)return[];let{data:t,error:r}=await this.supabase.from("gems").select("*").in("id",e);if(r)throw r;return t||[]}constructor(e){super(e,"gems")}}class n extends r{async searchJwellery(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,{data:r,error:s}=await this.supabase.from("jwellery").select("*").or("name.ilike.%".concat(e,"%,metal_type_purity.ilike.%").concat(e,"%,report_number.ilike.%").concat(e,"%")).order("created_at",{ascending:!1}).limit(t);if(s)throw s;return r||[]}async findActiveJwellery(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,{data:r,error:s}=await this.supabase.from("jwellery").select("*").eq("is_active",!0).order("created_at",{ascending:!1}).range(t,t+e-1);if(s)throw s;return r||[]}async findJwelleryWithFilters(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=this.supabase.from("jwellery").select("*").order("created_at",{ascending:!1});void 0!==e.minPrice&&(s=s.gte("price",e.minPrice)),void 0!==e.maxPrice&&(s=s.lte("price",e.maxPrice)),e.metal_type_purity&&(s=s.eq("metal_type_purity",e.metal_type_purity)),e.gemstone_type&&(s=s.eq("gemstone_type",e.gemstone_type)),void 0!==e.isActive&&(s=s.eq("is_active",e.isActive));let{data:i,error:n}=await s.range(r,r+t-1);if(n)throw n;return i||[]}constructor(e){super(e,"jwellery")}}class a extends r{async findByUserId(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,{data:s,error:i}=await this.supabase.from("orders").select("*").eq("user_id",e).order("created_at",{ascending:!1}).range(r,r+t-1);if(i)throw i;return s||[]}async findByStatus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,{data:s,error:i}=await this.supabase.from("orders").select("*").eq("status",e).order("created_at",{ascending:!1}).range(r,r+t-1);if(i)throw i;return s||[]}async updateStatus(e,t){let{data:r,error:s}=await this.supabase.from("orders").update({status:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s){if("PGRST116"===s.code)return null;throw s}return r}async updateTrackingNumber(e,t){let{data:r,error:s}=await this.supabase.from("orders").update({tracking_number:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s){if("PGRST116"===s.code)return null;throw s}return r}async updatePaymentStatus(e,t){let{data:r,error:s}=await this.supabase.from("orders").update({payment_status:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s){if("PGRST116"===s.code)return null;throw s}return r}async getOrderWithItems(e){let t=await this.findById(e);if(!t)return null;let{data:r,error:s}=await this.supabase.from("order_items").select("*").eq("order_id",e);if(s)throw s;return{...t,items:r||[]}}async getUserOrderHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=await this.findByUserId(e,t,r),i=s.map(e=>e.id);if(0===i.length)return[];let{data:n,error:a}=await this.supabase.from("order_items").select("*").in("order_id",i);if(a)throw a;let o=(n||[]).reduce((e,t)=>(e[t.order_id]||(e[t.order_id]=[]),e[t.order_id].push(t),e),{});return s.map(e=>({...e,items:o[e.id]||[]}))}async getTotalRevenue(){let{data:e,error:t}=await this.supabase.from("orders").select("total_amount").eq("payment_status","paid");if(t)throw t;return(e||[]).reduce((e,t)=>e+(t.total_amount||0),0)}async getOrdersByDateRange(e,t){let{data:r,error:s}=await this.supabase.from("orders").select("*").gte("created_at",e).lte("created_at",t).order("created_at",{ascending:!1});if(s)throw s;return r||[]}async cancelOrder(e){return this.updateStatus(e,"cancelled")}async getOrderStatistics(){let e=await this.count(),t=await this.getTotalRevenue(),r=await this.supabase.from("orders").select("*",{count:"exact",head:!0}).eq("status","pending"),s=await this.supabase.from("orders").select("*",{count:"exact",head:!0}).eq("status","delivered");return{totalOrders:e,totalRevenue:t,pendingOrders:r.count||0,completedOrders:s.count||0}}async createOrderWithItems(e,t){e.total_amount||(e.total_amount=t.reduce((e,t)=>e+t.total_price,0));let r=await this.create(e),s=t.map(e=>({order_id:r.id,gem_id:e.gem_id,quantity:e.quantity,unit_price:e.unit_price,total_price:e.total_price})),{data:i,error:n}=await this.supabase.from("order_items").insert(s).select();if(n)throw n;return{...r,items:i}}async createOrderItem(e){let{data:t,error:r}=await this.supabase.from("order_items").insert(e).select().single();if(r)throw r;return t}async getOrderItems(e){let{data:t,error:r}=await this.supabase.from("order_items").select("*").eq("order_id",e);if(r)throw r;return t||[]}constructor(e){super(e,"orders")}}class o extends r{async logAction(e){let{data:t,error:r}=await this.supabase.from("audit_logs").insert(e).select().single();if(r)throw r;return t}async findByUserId(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,{data:s,error:i}=await this.supabase.from("audit_logs").select("*").eq("user_id",e).order("created_at",{ascending:!1}).range(r,r+t-1);if(i)throw i;return s||[]}async findByEntity(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,{data:s,error:i}=await this.supabase.from("audit_logs").select("*").eq("entity_type",e).eq("entity_id",t).order("created_at",{ascending:!1}).limit(r);if(i)throw i;return s||[]}async findByAction(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,{data:s,error:i}=await this.supabase.from("audit_logs").select("*").eq("action",e).order("created_at",{ascending:!1}).range(r,r+t-1);if(i)throw i;return s||[]}async findByDateRange(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,{data:s,error:i}=await this.supabase.from("audit_logs").select("*").gte("created_at",e).lte("created_at",t).order("created_at",{ascending:!1}).limit(r);if(i)throw i;return s||[]}async getRecentActivity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,{data:t,error:r}=await this.supabase.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(e);if(r)throw r;return t||[]}async getEntityHistory(e,t){return this.findByEntity(e,t,1e3)}async searchLogs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,{data:r,error:s}=await this.supabase.from("audit_logs").select("*").or("action.ilike.%".concat(e,"%,entity_type.ilike.%").concat(e,"%")).order("created_at",{ascending:!1}).limit(t);if(s)throw s;return r||[]}async logUserAction(e,t,r){return this.logAction({user_id:e,action:t,entity_type:(null==r?void 0:r.entityType)||"user",entity_id:null==r?void 0:r.entityId,old_values:null==r?void 0:r.oldValues,new_values:null==r?void 0:r.newValues,ip_address:null==r?void 0:r.ipAddress,user_agent:null==r?void 0:r.userAgent})}async logAdminAction(e,t,r,s){return this.logAction({user_id:e,action:"admin_".concat(t),entity_type:r.type,entity_id:r.id,old_values:null==s?void 0:s.oldValues,new_values:null==s?void 0:s.newValues,ip_address:null==s?void 0:s.ipAddress,user_agent:null==s?void 0:s.userAgent})}async logSystemAction(e,t){return this.logAction({action:"system_".concat(e),entity_type:(null==t?void 0:t.entityType)||"system",entity_id:null==t?void 0:t.entityId,old_values:null==t?void 0:t.oldValues,new_values:null==t?void 0:t.newValues})}constructor(e){super(e,"audit_logs")}}class l{async create(e){let{data:t,error:r}=await this.supabase.from("payments").insert(e).select().single();if(r)throw r;return t}async findByOrderId(e){let{data:t,error:r}=await this.supabase.from("payments").select("*").eq("order_id",e).single();if(r){if("PGRST116"===r.code)return null;throw r}return t}async findByPayherePaymentId(e){let{data:t,error:r}=await this.supabase.from("payments").select("*").eq("payhere_payment_id",e).single();if(r){if("PGRST116"===r.code)return null;throw r}return t}async updateStatus(e,t,r){let s={status:t,...r};"completed"===t&&(s.completed_at=new Date().toISOString());let{data:i,error:n}=await this.supabase.from("payments").update(s).eq("order_id",e).select().single();if(n)throw n;return i}async findByUserId(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,{data:s,error:i}=await this.supabase.from("payments").select("*").eq("user_id",e).order("created_at",{ascending:!1}).range(r,r+t-1);if(i)throw i;return s||[]}async findAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,{data:r,error:s}=await this.supabase.from("payments").select("*").order("created_at",{ascending:!1}).range(t,t+e-1);if(s)throw s;return r||[]}async findByStatus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,{data:s,error:i}=await this.supabase.from("payments").select("*").eq("status",e).order("created_at",{ascending:!1}).range(r,r+t-1);if(i)throw i;return s||[]}async createWebhookLog(e){let{data:t,error:r}=await this.supabase.from("payment_webhook_logs").insert(e).select().single();if(r)throw r;return t}async getWebhookLogs(e){let{data:t,error:r}=await this.supabase.from("payment_webhook_logs").select("*").eq("order_id",e).order("created_at",{ascending:!1});if(r)throw r;return t||[]}async updateWebhookLog(e,t,r){let s={processing_status:t,processed_at:new Date().toISOString()};r&&(s.error_message=r);let{data:i,error:n}=await this.supabase.from("payment_webhook_logs").update(s).eq("id",e).select().single();if(n)throw n;return i}async delete(e){let{error:t}=await this.supabase.from("payments").delete().eq("order_id",e);if(t)throw t;return!0}constructor(e){t(this,"supabase",void 0),this.supabase=e}}class c{getUserRepository(){return this.userRepository||(this.userRepository=new s(this.supabase)),this.userRepository}getGemRepository(){return this.gemRepository||(this.gemRepository=new i(this.supabase)),this.gemRepository}getJwelleryRepository(){return this.jwelleryRepository||(this.jwelleryRepository=new n(this.supabase)),this.jwelleryRepository}getOrderRepository(){return this.orderRepository||(this.orderRepository=new a(this.supabase)),this.orderRepository}getAuditLogRepository(){return this.auditLogRepository||(this.auditLogRepository=new o(this.supabase)),this.auditLogRepository}getPaymentRepository(){return this.paymentRepository||(this.paymentRepository=new l(this.supabase)),this.paymentRepository}constructor(e){t(this,"supabase",void 0),t(this,"userRepository",void 0),t(this,"gemRepository",void 0),t(this,"jwelleryRepository",void 0),t(this,"orderRepository",void 0),t(this,"auditLogRepository",void 0),t(this,"paymentRepository",void 0),this.supabase=e}}var u,h,d,f,p,g,y,w,m,b,_,v,k,S=e.i(47167),E=e.i(90571);class T extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class O extends T{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class A extends T{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class j extends T{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(u||(u={}));class R{setAuth(e){this.headers.Authorization="Bearer ".concat(e)}invoke(e){return(0,E.__awaiter)(this,arguments,void 0,function*(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let s,{headers:i,method:n,body:a,signal:o}=r,l={},{region:c}=r;c||(c=this.region);let u=new URL("".concat(this.url,"/").concat(e));c&&"any"!==c&&(l["x-region"]=c,u.searchParams.set("forceFunctionRegion",c)),a&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?"undefined"!=typeof Blob&&a instanceof Blob||a instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",s=a):"string"==typeof a?(l["Content-Type"]="text/plain",s=a):"undefined"!=typeof FormData&&a instanceof FormData?s=a:(l["Content-Type"]="application/json",s=JSON.stringify(a)):s=a;let h=yield this.fetch(u.toString(),{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),i),body:s,signal:o}).catch(e=>{if("AbortError"===e.name)throw e;throw new O(e)}),d=h.headers.get("x-relay-error");if(d&&"true"===d)throw new A(h);if(!h.ok)throw new j(h);let f=(null!=(t=h.headers.get("Content-Type"))?t:"text/plain").split(";")[0].trim();return{data:"application/json"===f?yield h.json():"application/octet-stream"===f||"application/pdf"===f?yield h.blob():"text/event-stream"===f?h:"multipart/form-data"===f?yield h.formData():yield h.text(),error:null,response:h}}catch(e){if(e instanceof Error&&"AbortError"===e.name)return{data:null,error:new O(e)};return{data:null,error:e,response:e instanceof j||e instanceof A?e.context:void 0}}})}constructor(t,{headers:r={},customFetch:s,region:i=u.Any}={}){this.url=t,this.headers=r,this.region=i,this.fetch=(t=>{let r;return r=t||("undefined"==typeof fetch?function(){for(var t=arguments.length,r=Array(t),s=0;s<t;s++)r[s]=arguments[s];return e.A(11737).then(e=>{let{default:t}=e;return t(...r)})}:fetch),function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return r(...t)}})(s)}}let{PostgrestClient:I,PostgrestQueryBuilder:P,PostgrestFilterBuilder:C,PostgrestTransformBuilder:x,PostgrestBuilder:U,PostgrestError:N}=e.i(82215).default,B=class{static detectEnvironment(){var t;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if(void 0!==e.g.WebSocket)return{type:"native",constructor:e.g.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null==(t=navigator.userAgent)?void 0:t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(void 0!==S.default){let e=S.default.versions;if(e&&e.node){let t=parseInt(e.node.replace(/^v/,"").split(".")[0]);return t>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:"Node.js ".concat(t," detected but native WebSocket not found."),workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:"Node.js ".concat(t," detected without native WebSocket support."),workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+="\n\nSuggested solution: ".concat(e.workaround)),Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{let e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}},L="realtime-js/".concat("2.76.1");!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(h||(h={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(d||(d={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(f||(f={})),(p||(p={})).websocket="websocket",function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(g||(g={}));class q{decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):"string"==typeof e?t(JSON.parse(e)):t({})}_binaryDecode(e){let t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){let s=t.getUint8(1),i=t.getUint8(2),n=this.HEADER_LENGTH+2,a=r.decode(e.slice(n,n+s));n+=s;let o=r.decode(e.slice(n,n+i));return n+=i,{ref:null,topic:a,event:o,payload:JSON.parse(r.decode(e.slice(n,e.byteLength)))}}constructor(){this.HEADER_LENGTH=1}}class D{reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(y||(y={}));let M=function(e,t){var r;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=null!=(r=s.skipTypes)?r:[];return t?Object.keys(t).reduce((r,s)=>(r[s]=W(s,e,t,i),r),{}):{}},W=(e,t,r,s)=>{let i=t.find(t=>t.name===e),n=null==i?void 0:i.type,a=r[e];return n&&!s.includes(n)?V(n,a):K(a)},V=(e,t)=>{if("_"===e.charAt(0))return H(t,e.slice(1,e.length));switch(e){case y.bool:return F(t);case y.float4:case y.float8:case y.int2:case y.int4:case y.int8:case y.numeric:case y.oid:return G(t);case y.json:case y.jsonb:return J(t);case y.timestamp:return z(t);case y.abstime:case y.date:case y.daterange:case y.int4range:case y.int8range:case y.money:case y.reltime:case y.text:case y.time:case y.timestamptz:case y.timetz:case y.tsrange:case y.tstzrange:default:return K(t)}},K=e=>e,F=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},G=e=>{if("string"==typeof e){let t=parseFloat(e);if(!Number.isNaN(t))return t}return e},J=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){console.log("JSON parse error: ".concat(e))}return e},H=(e,t)=>{if("string"!=typeof e)return e;let r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s,i=e.slice(1,r);try{s=JSON.parse("["+i+"]")}catch(e){s=i?i.split(","):[]}return s.map(e=>V(t,e))}return e},z=e=>"string"==typeof e?e.replace(" ","T"):e,Y=e=>{let t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class ${resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null==(r=this.receivedResp)?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let e=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive(e){let{status:t,response:r}=e;this.recHooks.filter(e=>e.status===t).forEach(e=>e.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}}!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(w||(w={}));class X{static syncState(e,t,r,s){let i=this.cloneDeep(e),n=this.transformState(t),a={},o={};return this.map(i,(e,t)=>{n[e]||(o[e]=t)}),this.map(n,(e,t)=>{let r=i[e];if(r){let s=t.map(e=>e.presence_ref),i=r.map(e=>e.presence_ref),n=t.filter(e=>0>i.indexOf(e.presence_ref)),l=r.filter(e=>0>s.indexOf(e.presence_ref));n.length>0&&(a[e]=n),l.length>0&&(o[e]=l)}else a[e]=t}),this.syncDiff(i,{joins:a,leaves:o},r,s)}static syncDiff(e,t,r,s){let{joins:i,leaves:n}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(t,s)=>{var i;let n=null!=(i=e[t])?i:[];if(e[t]=this.cloneDeep(s),n.length>0){let r=e[t].map(e=>e.presence_ref),s=n.filter(e=>0>r.indexOf(e.presence_ref));e[t].unshift(...s)}r(t,n,s)}),this.map(n,(t,r)=>{let i=e[t];if(!i)return;let n=r.map(e=>e.presence_ref);i=i.filter(e=>0>n.indexOf(e.presence_ref)),e[t]=i,s(t,i,r),0===i.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return Object.getOwnPropertyNames(e=this.cloneDeep(e)).reduce((t,r)=>{let s=e[r];return"metas"in s?t[r]=s.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{let{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=X.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=X.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],s()}),this.channel._on(r.diff,{},e=>{let{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=X.syncDiff(this.state,e,t,r),s())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(m||(m={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(b||(b={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(_||(_={}));class Q{subscribe(e){var t,r,s;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeout;if(this.socket.isConnected()||this.socket.connect(),this.state==d.closed){let{config:{broadcast:n,presence:a,private:o}}=this.params,l=null!=(r=null==(t=this.bindings.postgres_changes)?void 0:t.map(e=>e.filter))?r:[],c=!!this.bindings[b.PRESENCE]&&this.bindings[b.PRESENCE].length>0||(null==(s=this.params.config.presence)?void 0:s.enabled)===!0,u={},h={broadcast:n,presence:Object.assign(Object.assign({},a),{enabled:c}),postgres_changes:l,private:o};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(_.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(_.CLOSED)),this.updateJoinPayload(Object.assign({config:h},u)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",async t=>{var r;let{postgres_changes:s}=t;if(this.socket.setAuth(),void 0===s){null==e||e(_.SUBSCRIBED);return}{let t=this.bindings.postgres_changes,i=null!=(r=null==t?void 0:t.length)?r:0,n=[];for(let r=0;r<i;r++){let i=t[r],{filter:{event:a,schema:o,table:l,filter:c}}=i,u=s&&s[r];if(u&&u.event===a&&u.schema===o&&u.table===l&&u.filter===c)n.push(Object.assign(Object.assign({},i),{id:u.id}));else{this.unsubscribe(),this.state=d.errored,null==e||e(_.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=n,e&&e(_.SUBSCRIBED);return}}).receive("error",t=>{this.state=d.errored,null==e||e(_.CHANNEL_ERROR,Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(_.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===d.joined&&e===b.PRESENCE&&(this.socket.log("channel","resubscribe to ".concat(this.topic," due to change in presence callbacks on joined channel")),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async httpSend(e,t){var r;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.socket.accessTokenValue?"Bearer ".concat(this.socket.accessTokenValue):"";if(null==t)return Promise.reject("Payload is required for httpSend()");let n={method:"POST",headers:{Authorization:i,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,n,null!=(r=s.timeout)?r:this.timeout);if(202===a.status)return{success:!0};let o=a.statusText;try{let e=await a.json();o=e.error||e.message||o}catch(e){}return Promise.reject(Error(o))}async send(e){var t,r;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._canPush()||"broadcast"!==e.type)return new Promise(t=>{var r,i,n;let a=this._push(e.type,e,s.timeout||this.timeout);"broadcast"!==e.type||(null==(n=null==(i=null==(r=this.params)?void 0:r.config)?void 0:i.broadcast)?void 0:n.ack)||t("ok"),a.receive("ok",()=>t("ok")),a.receive("error",()=>t("error")),a.receive("timeout",()=>t("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");let{event:i,payload:n}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?"Bearer ".concat(this.socket.accessTokenValue):"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:n,private:this.private}]})};try{let e=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!=(t=s.timeout)?t:this.timeout);return await (null==(r=e.body)?void 0:r.cancel()),e.ok?"ok":"error"}catch(e){if("AbortError"===e.name)return"timed out";return"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=d.leaving;let t=()=>{this.socket.log("channel","leave ".concat(this.topic)),this._trigger(f.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{(r=new $(this,f.leave,{},e)).receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=d.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){let s=new AbortController,i=setTimeout(()=>s.abort(),r),n=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),n}_push(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw"tried to push '".concat(e,"' to '").concat(this.topic,"' before joining. Use channel.subscribe() before pushing events");let s=new $(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){let e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel","discarded push due to buffer overflow: ".concat(e.event),e.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;let n=e.toLocaleLowerCase(),{close:a,error:o,leave:l,join:c}=f;if(r&&[a,o,l,c].indexOf(n)>=0&&r!==this._joinRef())return;let u=this._onMessage(n,t,r);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null==(s=this.bindings.postgres_changes)||s.filter(e=>{var t,r,s;return(null==(t=e.filter)?void 0:t.event)==="*"||(null==(s=null==(r=e.filter)?void 0:r.event)?void 0:s.toLocaleLowerCase())===n}).map(e=>e.callback(u,r)):null==(i=this.bindings[n])||i.filter(e=>{var r,s,i,a,o,l;if(!["broadcast","presence","postgres_changes"].includes(n))return e.type.toLocaleLowerCase()===n;if("id"in e){let n=e.id,a=null==(r=e.filter)?void 0:r.event;return n&&(null==(s=t.ids)?void 0:s.includes(n))&&("*"===a||(null==a?void 0:a.toLocaleLowerCase())===(null==(i=t.data)?void 0:i.type.toLocaleLowerCase()))}{let r=null==(o=null==(a=null==e?void 0:e.filter)?void 0:a.event)?void 0:o.toLocaleLowerCase();return"*"===r||r===(null==(l=null==t?void 0:t.event)?void 0:l.toLocaleLowerCase())}}).map(e=>{if("object"==typeof u&&"ids"in u){let e=u.data,{schema:t,table:r,commit_timestamp:s,type:i,errors:n}=e;u=Object.assign(Object.assign({},{schema:t,table:r,commit_timestamp:s,eventType:i,new:{},old:{},errors:n}),this._getPayloadRecords(e))}e.callback(u,r)})}_isClosed(){return this.state===d.closed}_isJoined(){return this.state===d.joined}_isJoining(){return this.state===d.joining}_isLeaving(){return this.state===d.leaving}_replyEventName(e){return"chan_reply_".concat(e)}_on(e,t,r){let s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){let r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(e=>{var s;return!((null==(s=e.type)?void 0:s.toLocaleLowerCase())===r&&Q.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(f.close,{},e)}_onError(e){this._on(f.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=d.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return("INSERT"===e.type||"UPDATE"===e.type)&&(t.new=M(e.columns,e.record)),("UPDATE"===e.type||"DELETE"===e.type)&&(t.old=M(e.columns,e.old_record)),t}constructor(e,t={config:{}},r){var s,i;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=d.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new $(this,f.join,this.params,this.timeout),this.rejoinTimer=new D(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=d.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel","close ".concat(this.topic," ").concat(this._joinRef())),this.state=d.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=d.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel","timeout ".concat(this.topic),this.joinPush.timeout),this.state=d.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=d.errored,this.rejoinTimer.scheduleTimeout())}),this._on(f.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new X(this),this.broadcastEndpointURL=Y(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null==(i=null==(s=this.params.config)?void 0:s.broadcast)?void 0:i.replay))throw"tried to use replay on public channel '".concat(this.topic,"'. It must be a private channel.")}}let Z=()=>{},ee={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},et=[1e3,2e3,5e3,1e4];class er{connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=B.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");let e=t.message;if(e.includes("Node.js"))throw Error("".concat(e,"\n\n")+'To use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })');throw Error("WebSocket not available: ".concat(e))}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){let r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){let t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){let e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case h.connecting:return g.Connecting;case h.open:return g.Open;case h.closing:return g.Closing;default:return g.Closed}}isConnected(){return this.connectionState()===g.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}},r="realtime:".concat(e),s=this.getChannels().find(e=>e.topic===r);if(s)return s;{let r=new Q("realtime:".concat(e),t,this);return this.channels.push(r),r}}push(e){let{topic:t,event:r,payload:s,ref:i}=e,n=()=>{this.encode(e,e=>{var t;null==(t=this.conn)||t.send(e)})};this.log("push","".concat(t," ").concat(r," (").concat(i,")"),s),this.isConnected()?n():this.sendBuffer.push(n)}async setAuth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}this._wasManualDisconnect=!1,null==(e=this.conn)||e.close(1e3,"heartbeat timeout"),setTimeout(()=>{var e;this.isConnected()||null==(e=this.reconnectTimer)||e.scheduleTimeout()},ee.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",'leaving duplicate topic "'.concat(e,'"')),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(e){this.log("error","error in heartbeat callback",e)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);let{topic:t,event:r,payload:s,ref:i}=e,n=s.status||"";this.log("receive","".concat(n," ").concat(t," ").concat(r," ").concat(i?"(".concat(i,")"):"").trim(),s),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,s,i)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null==(t=this.reconnectTimer)||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport","connected to ".concat(this.endpointURL())),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker","starting worker for from ".concat(this.workerUrl)):this.log("worker","starting default worker");let e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null==(t=this.reconnectTimer)||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport","".concat(e)),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(f.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;let r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return"".concat(e).concat(r).concat(s)}_workerObjectUrl(e){let t;if(e)t=e;else{let e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=t||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e,version:L}),t.joinedOnce&&t._isJoined()&&t._push(f.access_token,{access_token:e})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"general";this.setAuth().catch(t=>{this.log("error","error setting auth in ".concat(e),t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(t){this.log("error","error in ".concat(e," callback"),t)}})}catch(t){this.log("error","error triggering ".concat(e," callbacks"),t)}}_setupReconnectionTimer(){this.reconnectTimer=new D(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ee.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,i,n,a,o,l,c;if(this.transport=null!=(t=null==e?void 0:e.transport)?t:null,this.timeout=null!=(r=null==e?void 0:e.timeout)?r:1e4,this.heartbeatIntervalMs=null!=(s=null==e?void 0:e.heartbeatIntervalMs)?s:ee.HEARTBEAT_INTERVAL,this.worker=null!=(i=null==e?void 0:e.worker)&&i,this.accessToken=null!=(n=null==e?void 0:e.accessToken)?n:null,this.heartbeatCallback=null!=(a=null==e?void 0:e.heartbeatCallback)?a:Z,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!=(o=null==e?void 0:e.reconnectAfterMs)?o:e=>et[e-1]||1e4,this.encode=null!=(l=null==e?void 0:e.encode)?l:(e,t)=>t(JSON.stringify(e)),this.decode=null!=(c=null==e?void 0:e.decode)?c:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!=typeof window&&!window.Worker)throw Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}constructor(t,r){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=ee.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Z,this.ref=0,this.reconnectTimer=null,this.logger=Z,this.conn=null,this.sendBuffer=[],this.serializer=new q,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=t=>{let r;return r=t||("undefined"==typeof fetch?function(){for(var t=arguments.length,r=Array(t),s=0;s<t;s++)r[s]=arguments[s];return e.A(11737).then(e=>{let{default:t}=e;return t(...r)}).catch(e=>{throw Error("Failed to load @supabase/node-fetch: ".concat(e.message,". ")+"This is required for HTTP requests in Node.js environments without native fetch.")})}:fetch),function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return r(...t)}},!(null==(s=null==r?void 0:r.params)?void 0:s.apikey))throw Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint="".concat(t,"/").concat(p.websocket),this.httpEndpoint=Y(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==r?void 0:r.fetch)}}var es=e.i(67034);class ei extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function en(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class ea extends ei{toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}}class eo extends ei{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}let el=t=>{let r;return r=t||("undefined"==typeof fetch?function(){for(var t=arguments.length,r=Array(t),s=0;s<t;s++)r[s]=arguments[s];return e.A(11737).then(e=>{let{default:t}=e;return t(...r)})}:fetch),function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return r(...t)}},ec=e=>{if(Array.isArray(e))return e.map(e=>ec(e));if("function"==typeof e||e!==Object(e))return e;let t={};return Object.entries(e).forEach(e=>{let[r,s]=e;t[r.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""))]=ec(s)}),t},eu=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e);function eh(t,r,s,i,n,a){return(0,E.__awaiter)(this,void 0,void 0,function*(){return new Promise((o,l)=>{t(s,((e,t,r,s)=>{let i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&s?((e=>{if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(s)?(i.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),i.body=JSON.stringify(s)):i.body=s,(null==t?void 0:t.duplex)&&(i.duplex=t.duplex),Object.assign(Object.assign({},i),r)):i})(r,i,n,a)).then(e=>{if(!e.ok)throw e;return(null==i?void 0:i.noResolveJson)?e:e.json()}).then(e=>o(e)).catch(t=>(0,E.__awaiter)(void 0,void 0,void 0,function*(){t instanceof(yield(0,E.__awaiter)(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield e.A(11737)).Response:Response}))&&!(null==i?void 0:i.noResolveJson)?t.json().then(e=>{let r=t.status||500,s=(null==e?void 0:e.statusCode)||r+"";l(new ea(eu(e),r,s))}).catch(e=>{l(new eo(eu(e),e))}):l(new eo(eu(t),t))}))})})}function ed(e,t,r,s){return(0,E.__awaiter)(this,void 0,void 0,function*(){return eh(e,"GET",t,r,s)})}function ef(e,t,r,s,i){return(0,E.__awaiter)(this,void 0,void 0,function*(){return eh(e,"POST",t,s,i,r)})}function ep(e,t,r,s,i){return(0,E.__awaiter)(this,void 0,void 0,function*(){return eh(e,"PUT",t,s,i,r)})}function eg(e,t,r,s,i){return(0,E.__awaiter)(this,void 0,void 0,function*(){return eh(e,"DELETE",t,s,i,r)})}class ey{then(e,t){return this.execute().then(e,t)}execute(){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}}v=Symbol.toStringTag;let ew=class{asStream(){return new ey(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{let e=yield this.downloadFn();return{data:yield e.blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[v]="BlobDownloadBuilder",this.promise=null}},em={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},eb={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class e_{throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,r,s){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{let i,n=Object.assign(Object.assign({},eb),s),a=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(n.upsert)}),o=n.metadata;"undefined"!=typeof Blob&&r instanceof Blob?((i=new FormData).append("cacheControl",n.cacheControl),o&&i.append("metadata",this.encodeMetadata(o)),i.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?((i=r).append("cacheControl",n.cacheControl),o&&i.append("metadata",this.encodeMetadata(o))):(i=r,a["cache-control"]="max-age=".concat(n.cacheControl),a["content-type"]=n.contentType,o&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(o)))),(null==s?void 0:s.headers)&&(a=Object.assign(Object.assign({},a),s.headers));let l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=yield("PUT"==e?ep:ef)(this.fetch,"".concat(this.url,"/object/").concat(c),i,Object.assign({headers:a},(null==n?void 0:n.duplex)?{duplex:n.duplex}:{}));return{data:{path:l,id:u.Id,fullPath:u.Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}upload(e,t,r){return(0,E.__awaiter)(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return(0,E.__awaiter)(this,void 0,void 0,function*(){let i=this._removeEmptyFolders(e),n=this._getFinalPath(i),a=new URL(this.url+"/object/upload/sign/".concat(n));a.searchParams.set("token",t);try{let e,t=Object.assign({upsert:eb.upsert},s),n=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?((e=new FormData).append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r).append("cacheControl",t.cacheControl):(e=r,n["cache-control"]="max-age=".concat(t.cacheControl),n["content-type"]=t.contentType);let o=yield ep(this.fetch,a.toString(),e,{headers:n});return{data:{path:i,fullPath:o.Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}createSignedUploadUrl(e,t){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),s=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");let i=yield ef(this.fetch,"".concat(this.url,"/object/upload/sign/").concat(r),{},{headers:s}),n=new URL(this.url+i.url),a=n.searchParams.get("token");if(!a)throw new ei("No token returned by API");return{data:{signedUrl:n.toString(),path:e,token:a},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}update(e,t,r){return(0,E.__awaiter)(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield ef(this.fetch,"".concat(this.url,"/object/move"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}copy(e,t,r){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:{path:(yield ef(this.fetch,"".concat(this.url,"/object/copy"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}createSignedUrl(e,t,r){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield ef(this.fetch,"".concat(this.url,"/object/sign/").concat(s),Object.assign({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers}),n=(null==r?void 0:r.download)?"&download=".concat(!0===r.download?"":r.download):"";return{data:i={signedUrl:encodeURI("".concat(this.url).concat(i.signedURL).concat(n))},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}createSignedUrls(e,t,r){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{let s=yield ef(this.fetch,"".concat(this.url,"/object/sign/").concat(this.bucketId),{expiresIn:t,paths:e},{headers:this.headers}),i=(null==r?void 0:r.download)?"&download=".concat(!0===r.download?"":r.download):"";return{data:s.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI("".concat(this.url).concat(e.signedURL).concat(i)):null})),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}download(e,t){let r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),i=s?"?".concat(s):"",n=this._getFinalPath(e);return new ew(()=>ed(this.fetch,"".concat(this.url,"/").concat(r,"/").concat(n).concat(i),{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{let e=yield ed(this.fetch,"".concat(this.url,"/object/info/").concat(t),{headers:this.headers});return{data:ec(e),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}exists(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{return yield function(e,t,r,s){return(0,E.__awaiter)(this,void 0,void 0,function*(){return eh(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),void 0)})}(this.fetch,"".concat(this.url,"/object/").concat(t),{headers:this.headers}),{data:!0,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e)&&e instanceof eo){let t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}})}getPublicUrl(e,t){let r=this._getFinalPath(e),s=[],i=(null==t?void 0:t.download)?"download=".concat(!0===t.download?"":t.download):"";""!==i&&s.push(i);let n=void 0!==(null==t?void 0:t.transform),a=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==a&&s.push(a);let o=s.join("&");return""!==o&&(o="?".concat(o)),{data:{publicUrl:encodeURI("".concat(this.url,"/").concat(n?"render/image":"object","/public/").concat(r).concat(o))}}}remove(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eg(this.fetch,"".concat(this.url,"/object/").concat(this.bucketId),{prefixes:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}list(e,t,r){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{let s=Object.assign(Object.assign(Object.assign({},em),t),{prefix:e||""});return{data:yield ef(this.fetch,"".concat(this.url,"/object/list/").concat(this.bucketId),s,{headers:this.headers},r),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}listV2(e,t){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{let r=Object.assign({},e);return{data:yield ef(this.fetch,"".concat(this.url,"/object/list-v2/").concat(this.bucketId),r,{headers:this.headers},t),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return void 0!==es.Buffer?es.Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return"".concat(this.bucketId,"/").concat(e.replace(/^\/+/,""))}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push("width=".concat(e.width)),e.height&&t.push("height=".concat(e.height)),e.resize&&t.push("resize=".concat(e.resize)),e.format&&t.push("format=".concat(e.format)),e.quality&&t.push("quality=".concat(e.quality)),t.join("&")}constructor(e,t={},r,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=el(s)}}let ev="2.76.1",ek={"X-Client-Info":"storage-js/".concat(ev)};class eS{throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield ed(this.fetch,"".concat(this.url,"/bucket"),{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}getBucket(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield ed(this.fetch,"".concat(this.url,"/bucket/").concat(e),{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}createBucket(e){return(0,E.__awaiter)(this,arguments,void 0,function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{public:!1};try{return{data:yield ef(this.fetch,"".concat(this.url,"/bucket"),{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}updateBucket(e,t){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield ep(this.fetch,"".concat(this.url,"/bucket/").concat(e),{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}emptyBucket(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield ef(this.fetch,"".concat(this.url,"/bucket/").concat(e,"/empty"),{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}deleteBucket(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eg(this.fetch,"".concat(this.url,"/bucket/").concat(e),{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}constructor(e,t={},r,s){this.shouldThrowOnError=!1;let i=new URL(e);(null==s?void 0:s.useNewHostname)&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},ek),t),this.fetch=el(r)}}class eE{throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield ef(this.fetch,"".concat(this.url,"/bucket"),{name:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}listBuckets(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{let t=new URLSearchParams;(null==e?void 0:e.limit)!==void 0&&t.set("limit",e.limit.toString()),(null==e?void 0:e.offset)!==void 0&&t.set("offset",e.offset.toString()),(null==e?void 0:e.sortColumn)&&t.set("sortColumn",e.sortColumn),(null==e?void 0:e.sortOrder)&&t.set("sortOrder",e.sortOrder),(null==e?void 0:e.search)&&t.set("search",e.search);let r=t.toString(),s=r?"".concat(this.url,"/bucket?").concat(r):"".concat(this.url,"/bucket"),i=yield ed(this.fetch,s,{headers:this.headers});return{data:Array.isArray(i)?i.filter(e=>"ANALYTICS"===e.type):[],error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}deleteBucket(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eg(this.fetch,"".concat(this.url,"/bucket/").concat(e),{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(en(e))return{data:null,error:e};throw e}})}constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},ek),t),this.fetch=el(r)}}let eT={"X-Client-Info":"storage-js/".concat(ev),"Content-Type":"application/json"};class eO extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function eA(e){return"object"==typeof e&&null!==e&&"__isStorageVectorsError"in e}class ej extends eO{toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}constructor(e,t,r){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=r}}class eR extends eO{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}!function(e){e.InternalError="InternalError",e.S3VectorConflictException="S3VectorConflictException",e.S3VectorNotFoundException="S3VectorNotFoundException",e.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",e.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",e.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"}(k||(k={}));let eI=t=>{let r;return r=t||("undefined"==typeof fetch?function(){for(var t=arguments.length,r=Array(t),s=0;s<t;s++)r[s]=arguments[s];return e.A(11737).then(e=>{let{default:t}=e;return t(...r)})}:fetch),function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return r(...t)}},eP=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e);function eC(e,t,r,s,i){return(0,E.__awaiter)(this,void 0,void 0,function*(){return function(e,t,r,s,i,n){return(0,E.__awaiter)(this,void 0,void 0,function*(){return new Promise((a,o)=>{e(r,((e,t,r,s)=>{let i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&s?((e=>{if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(s)?(i.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),i.body=JSON.stringify(s)):i.body=s,Object.assign(Object.assign({},i),r)):i})(t,s,i,n)).then(e=>{if(!e.ok)throw e;if(null==s?void 0:s.noResolveJson)return e;let t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():{}}).then(e=>a(e)).catch(e=>(0,E.__awaiter)(void 0,void 0,void 0,function*(){if(!(e&&"object"==typeof e&&"status"in e&&"ok"in e&&"number"==typeof e.status)||(null==s?void 0:s.noResolveJson))o(new eR(eP(e),e));else{let t=e.status||500;"function"==typeof e.json?e.json().then(e=>{let r=(null==e?void 0:e.statusCode)||(null==e?void 0:e.code)||t+"";o(new ej(eP(e),t,r))}).catch(()=>{o(new ej(e.statusText||"HTTP ".concat(t," error"),t,t+""))}):o(new ej(e.statusText||"HTTP ".concat(t," error"),t,t+""))}}))})})}(e,"POST",t,s,i,r)})}class ex{throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield eC(this.fetch,"".concat(this.url,"/CreateIndex"),e,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}getIndex(e,t){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eC(this.fetch,"".concat(this.url,"/GetIndex"),{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}listIndexes(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eC(this.fetch,"".concat(this.url,"/ListIndexes"),e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}deleteIndex(e,t){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield eC(this.fetch,"".concat(this.url,"/DeleteIndex"),{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eT),t),this.fetch=eI(r)}}class eU{throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw Error("Vector batch size must be between 1 and 500 items");return{data:(yield eC(this.fetch,"".concat(this.url,"/PutVectors"),e,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}getVectors(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eC(this.fetch,"".concat(this.url,"/GetVectors"),e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}listVectors(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw Error("segmentIndex must be between 0 and ".concat(e.segmentCount-1))}return{data:yield eC(this.fetch,"".concat(this.url,"/ListVectors"),e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}queryVectors(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eC(this.fetch,"".concat(this.url,"/QueryVectors"),e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}deleteVectors(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw Error("Keys batch size must be between 1 and 500 items");return{data:(yield eC(this.fetch,"".concat(this.url,"/DeleteVectors"),e,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eT),t),this.fetch=eI(r)}}class eN{throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield eC(this.fetch,"".concat(this.url,"/CreateVectorBucket"),{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}getBucket(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eC(this.fetch,"".concat(this.url,"/GetVectorBucket"),{vectorBucketName:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}listBuckets(){return(0,E.__awaiter)(this,arguments,void 0,function*(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return{data:yield eC(this.fetch,"".concat(this.url,"/ListVectorBuckets"),e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}deleteBucket(e){return(0,E.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield eC(this.fetch,"".concat(this.url,"/DeleteVectorBucket"),{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eT),t),this.fetch=eI(r)}}class eB extends eN{from(e){return new eL(this.url,this.headers,e,this.fetch)}constructor(e,t={}){super(e,t.headers||{},t.fetch)}}class eL extends ex{createIndex(e){let t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return(0,E.__awaiter)(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){let e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return(0,E.__awaiter)(this,arguments,void 0,function*(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){let t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return(0,E.__awaiter)(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){let t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return(0,E.__awaiter)(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new eq(this.url,this.headers,this.vectorBucketName,e,this.fetch)}constructor(e,t,r,s){super(e,t,s),this.vectorBucketName=r}}class eq extends eU{putVectors(e){let t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return(0,E.__awaiter)(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){let t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return(0,E.__awaiter)(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){let e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return(0,E.__awaiter)(this,arguments,void 0,function*(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){let t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return(0,E.__awaiter)(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){let t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return(0,E.__awaiter)(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}constructor(e,t,r,s,i){super(e,t,i),this.vectorBucketName=r,this.indexName=s}}class eD extends eS{from(e){return new e_(this.url,this.headers,e,this.fetch)}get vectors(){return new eB(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new eE(this.url+"/iceberg",this.headers,this.fetch)}constructor(e,t={},r,s){super(e,t,r,s)}}let eM="";eM="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";let eW={headers:{"X-Client-Info":"supabase-js-".concat(eM,"/").concat("2.76.1")}},eV={schema:"public"},eK={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},eF={};var eG=e.i(6085);let eJ="2.76.1",eH="X-Supabase-Api-Version",ez={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},eY=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class e$ extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function eX(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class eQ extends e${constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}class eZ extends e${constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class e0 extends e${constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class e1 extends e0{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class e2 extends e0{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class e5 extends e0{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class e6 extends e0{toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}}class e8 extends e0{toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}}class e3 extends e0{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function e4(e){return eX(e)&&"AuthRetryableFetchError"===e.name}class e9 extends e0{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class e7 extends e0{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}let te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),tt=" 	\n\r=".split(""),tr=(()=>{let e=Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<tt.length;t+=1)e[tt[t].charCodeAt(0)]=-2;for(let t=0;t<te.length;t+=1)e[te[t].charCodeAt(0)]=t;return e})();function ts(e,t,r){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;)r(te[t.queue>>t.queuedBits-6&63]),t.queuedBits-=6;else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;)r(te[t.queue>>t.queuedBits-6&63]),t.queuedBits-=6}function ti(e,t,r){let s=tr[e];if(s>-1)for(t.queue=t.queue<<6|s,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else if(-2===s)return;else throw Error('Invalid Base64-URL character "'.concat(String.fromCharCode(e),'"'))}function tn(e){let t=[],r=e=>{t.push(String.fromCodePoint(e))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},n=e=>{!function(e,t,r){if(0===t.utf8seq){if(e<=127)return r(e);for(let r=1;r<6;r+=1)if((e>>7-r&1)==0){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else if(4===t.utf8seq)t.codepoint=7&e;else throw Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}}(e,s,r)};for(let t=0;t<e.length;t+=1)ti(e.charCodeAt(t),i,n);return t.join("")}function ta(e){let t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};for(let t=0;t<e.length;t+=1)ti(e.charCodeAt(t),r,s);return new Uint8Array(t)}function to(e){let t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};return e.forEach(e=>ts(e,r,s)),ts(null,r,s),t.join("")}let tl=()=>"undefined"!=typeof window&&"undefined"!=typeof document,tc={tested:!1,writable:!1},tu=()=>{if(!tl())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(tc.tested)return tc.writable;let e="lswt-".concat(Math.random()).concat(Math.random());try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),tc.tested=!0,tc.writable=!0}catch(e){tc.tested=!0,tc.writable=!1}return tc.writable},th=t=>{let r;return r=t||("undefined"==typeof fetch?function(){for(var t=arguments.length,r=Array(t),s=0;s<t;s++)r[s]=arguments[s];return e.A(11737).then(e=>{let{default:t}=e;return t(...r)})}:fetch),function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return r(...t)}},td=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},tf=async(e,t)=>{let r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(e){return r}},tp=async(e,t)=>{await e.removeItem(t)};class tg{constructor(){this.promise=new tg.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function ty(e){let t=e.split(".");if(3!==t.length)throw new e7("Invalid JWT structure");for(let e=0;e<t.length;e++)if(!eY.test(t[e]))throw new e7("JWT not in base64url format");return{header:JSON.parse(tn(t[0])),payload:JSON.parse(tn(t[1])),signature:ta(t[2]),raw:{header:t[0],payload:t[1]}}}async function tw(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function tm(e){return("0"+e.toString(16)).substr(-2)}async function tb(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>String.fromCharCode(e)).join("")}async function t_(e){return"undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder?(console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e):btoa(await tb(e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function tv(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=function(){let e=new Uint32Array(56);if("undefined"==typeof crypto){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length,r="";for(let s=0;s<56;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,tm).join("")}(),i=s;r&&(i+="/PASSWORD_RECOVERY"),await td(e,"".concat(t,"-code-verifier"),i);let n=await t_(s),a=s===n?"plain":"s256";return[n,a]}tg.promiseConstructor=Promise;let tk=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,tS=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function tE(e){if(!tS.test(e))throw Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function tT(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){let e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "'.concat(t,'" property of the session object is not supported. Please use getUser() instead.'))},set:(e,t)=>{throw Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))},deleteProperty:(e,t)=>{throw Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))}})}function tO(e){return JSON.parse(JSON.stringify(e))}let tA=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),tj=[502,503,504];async function tR(e){var t;let r,s;if(!("object"==typeof e&&null!==e&&"status"in e&&"ok"in e&&"json"in e&&"function"==typeof e.json))throw new e3(tA(e),0);if(tj.includes(e.status))throw new e3(tA(e),e.status);try{r=await e.json()}catch(e){throw new eZ(tA(e),e)}let i=function(e){let t=e.headers.get(eH);if(!t||!t.match(tk))return null;try{return new Date("".concat(t,"T00:00:00.0Z"))}catch(e){return null}}(e);if(i&&i.getTime()>=ez["2024-01-01"].timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?s=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(s=r.error_code),s){if("weak_password"===s)throw new e9(tA(r),e.status,(null==(t=r.weak_password)?void 0:t.reasons)||[]);else if("session_not_found"===s)throw new e1}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new e9(tA(r),e.status,r.weak_password.reasons);throw new eQ(tA(r),e.status||500,s)}async function tI(e,t,r,s){var i;let n=Object.assign({},null==s?void 0:s.headers);n[eH]||(n[eH]=ez["2024-01-01"].name),(null==s?void 0:s.jwt)&&(n.Authorization="Bearer ".concat(s.jwt));let a=null!=(i=null==s?void 0:s.query)?i:{};(null==s?void 0:s.redirectTo)&&(a.redirect_to=s.redirectTo);let o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await tP(e,t,r+o,{headers:n,noResolveJson:null==s?void 0:s.noResolveJson},{},null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function tP(e,t,r,s,i,n){let a,o=((e,t,r,s)=>{let i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),r))})(t,s,i,n);try{a=await e(r,Object.assign({},o))}catch(e){throw console.error(e),new e3(tA(e),0)}if(a.ok||await tR(a),null==s?void 0:s.noResolveJson)return a;try{return await a.json()}catch(e){await tR(e)}}function tC(e){var t,r,s;let i=null;(s=e).access_token&&s.refresh_token&&s.expires_in&&(i=Object.assign({},e),e.expires_at||(i.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:i,user:null!=(t=e.user)?t:e},error:null}}function tx(e){let t=tC(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function tU(e){var t;return{data:{user:null!=(t=e.user)?t:e},error:null}}function tN(e){return{data:e,error:null}}function tB(e){let{action_link:t,email_otp:r,hashed_token:s,redirect_to:i,verification_type:n}=e;return{data:{properties:{action_link:t,email_otp:r,hashed_token:s,redirect_to:i,verification_type:n},user:Object.assign({},(0,E.__rest)(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]))},error:null}}function tL(e){return e}let tq=["global","local","others"];class tD{async signOut(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tq[0];if(0>tq.indexOf(t))throw Error("@supabase/auth-js: Parameter scope must be one of ".concat(tq.join(", ")));try{return await tI(this.fetch,"POST","".concat(this.url,"/logout?scope=").concat(t),{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(eX(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await tI(this.fetch,"POST","".concat(this.url,"/invite"),{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:tU})}catch(e){if(eX(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{let{options:t}=e,r=(0,E.__rest)(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=null==r?void 0:r.newEmail,delete s.newEmail),await tI(this.fetch,"POST","".concat(this.url,"/admin/generate_link"),{body:s,headers:this.headers,xform:tB,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(eX(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await tI(this.fetch,"POST","".concat(this.url,"/admin/users"),{body:e,headers:this.headers,xform:tU})}catch(e){if(eX(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,r,s,i,n,a,o;try{let l={nextPage:null,lastPage:0,total:0},c=await tI(this.fetch,"GET","".concat(this.url,"/admin/users"),{headers:this.headers,noResolveJson:!0,query:{page:null!=(r=null==(t=null==e?void 0:e.page)?void 0:t.toString())?r:"",per_page:null!=(i=null==(s=null==e?void 0:e.perPage)?void 0:s.toString())?i:""},xform:tL});if(c.error)throw c.error;let u=await c.json(),h=null!=(n=c.headers.get("x-total-count"))?n:0,d=null!=(o=null==(a=c.headers.get("link"))?void 0:a.split(","))?o:[];return d.length>0&&(d.forEach(e=>{let t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l["".concat(r,"Page")]=t}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(e){if(eX(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){tE(e);try{return await tI(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,xform:tU})}catch(e){if(eX(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){tE(e);try{return await tI(this.fetch,"PUT","".concat(this.url,"/admin/users/").concat(e),{body:t,headers:this.headers,xform:tU})}catch(e){if(eX(e))return{data:{user:null},error:e};throw e}}async deleteUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];tE(e);try{return await tI(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,body:{should_soft_delete:t},xform:tU})}catch(e){if(eX(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){tE(e.userId);try{let{data:t,error:r}=await tI(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e.userId,"/factors"),{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(e){if(eX(e))return{data:null,error:e};throw e}}async _deleteFactor(e){tE(e.userId),tE(e.id);try{return{data:await tI(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e.userId,"/factors/").concat(e.id),{headers:this.headers}),error:null}}catch(e){if(eX(e))return{data:null,error:e};throw e}}async _listOAuthClients(e){var t,r,s,i,n,a,o;try{let l={nextPage:null,lastPage:0,total:0},c=await tI(this.fetch,"GET","".concat(this.url,"/admin/oauth/clients"),{headers:this.headers,noResolveJson:!0,query:{page:null!=(r=null==(t=null==e?void 0:e.page)?void 0:t.toString())?r:"",per_page:null!=(i=null==(s=null==e?void 0:e.perPage)?void 0:s.toString())?i:""},xform:tL});if(c.error)throw c.error;let u=await c.json(),h=null!=(n=c.headers.get("x-total-count"))?n:0,d=null!=(o=null==(a=c.headers.get("link"))?void 0:a.split(","))?o:[];return d.length>0&&(d.forEach(e=>{let t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l["".concat(r,"Page")]=t}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(e){if(eX(e))return{data:{clients:[]},error:e};throw e}}async _createOAuthClient(e){try{return await tI(this.fetch,"POST","".concat(this.url,"/admin/oauth/clients"),{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(eX(e))return{data:null,error:e};throw e}}async _getOAuthClient(e){try{return await tI(this.fetch,"GET","".concat(this.url,"/admin/oauth/clients/").concat(e),{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(eX(e))return{data:null,error:e};throw e}}async _deleteOAuthClient(e){try{return await tI(this.fetch,"DELETE","".concat(this.url,"/admin/oauth/clients/").concat(e),{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(eX(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(e){try{return await tI(this.fetch,"POST","".concat(this.url,"/admin/oauth/clients/").concat(e,"/regenerate_secret"),{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(eX(e))return{data:null,error:e};throw e}}constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=th(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}}function tM(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}let tW={debug:!!(globalThis&&tu()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"))};class tV extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class tK extends tV{}async function tF(e,t,r){tW.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);let s=new globalThis.AbortController;return t>0&&setTimeout(()=>{s.abort(),tW.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async s=>{if(s){tW.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{tW.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}if(0===t)throw tW.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new tK('Acquiring an exclusive Navigator LockManager lock "'.concat(e,'" immediately failed'));if(tW.debug)try{let e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}))}function tG(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw Error('@supabase/auth-js: Address "'.concat(e,'" is invalid.'));return e.toLowerCase()}class tJ extends Error{constructor({message:e,code:t,cause:r,name:s}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=null!=(i=null!=s?s:r instanceof Error?r.name:void 0)?i:"Unknown Error",this.code=t}}class tH extends tJ{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}let tz=new class{createNewAbortSignal(){if(this.controller){let e=Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}let e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){let e=Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function tY(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function t$(){var e,t;return!!(tl()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null==(e=null==navigator?void 0:navigator.credentials)?void 0:e.create)&&"function"==typeof(null==(t=null==navigator?void 0:navigator.credentials)?void 0:t.get))}async function tX(e){try{let t=await navigator.credentials.create(e);if(!t)return{data:null,error:new tH("Empty credential response",t)};if(!(t instanceof PublicKeyCredential))return{data:null,error:new tH("Browser returned unexpected credential type",t)};return{data:t,error:null}}catch(t){return{data:null,error:function(e){var t,r,s;let{error:i,options:n}=e,{publicKey:a}=n;if(!a)throw Error("options was missing required publicKey property");if("AbortError"===i.name){if(n.signal instanceof AbortSignal)return new tJ({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:i})}else if("ConstraintError"===i.name){if((null==(t=a.authenticatorSelection)?void 0:t.requireResidentKey)===!0)return new tJ({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:i});else if("conditional"===n.mediation&&(null==(r=a.authenticatorSelection)?void 0:r.userVerification)==="required")return new tJ({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:i});else if((null==(s=a.authenticatorSelection)?void 0:s.userVerification)==="required")return new tJ({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:i})}else if("InvalidStateError"===i.name)return new tJ({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:i});else if("NotAllowedError"===i.name)return new tJ({message:i.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i});else if("NotSupportedError"===i.name)return new tJ(0===a.pubKeyCredParams.filter(e=>"public-key"===e.type).length?{message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:i}:{message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:i});else if("SecurityError"===i.name){let e=window.location.hostname;if(!tY(e))return new tJ({message:"".concat(window.location.hostname," is an invalid domain"),code:"ERROR_INVALID_DOMAIN",cause:i});if(a.rp.id!==e)return new tJ({message:'The RP ID "'.concat(a.rp.id,'" is invalid for this domain'),code:"ERROR_INVALID_RP_ID",cause:i})}else if("TypeError"===i.name){if(a.user.id.byteLength<1||a.user.id.byteLength>64)return new tJ({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:i})}else if("UnknownError"===i.name)return new tJ({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:i});return new tJ({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i})}({error:t,options:e})}}}async function tQ(e){try{let t=await navigator.credentials.get(e);if(!t)return{data:null,error:new tH("Empty credential response",t)};if(!(t instanceof PublicKeyCredential))return{data:null,error:new tH("Browser returned unexpected credential type",t)};return{data:t,error:null}}catch(t){return{data:null,error:function(e){let{error:t,options:r}=e,{publicKey:s}=r;if(!s)throw Error("options was missing required publicKey property");if("AbortError"===t.name){if(r.signal instanceof AbortSignal)return new tJ({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if("NotAllowedError"===t.name)return new tJ({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});else if("SecurityError"===t.name){let e=window.location.hostname;if(!tY(e))return new tJ({message:"".concat(window.location.hostname," is an invalid domain"),code:"ERROR_INVALID_DOMAIN",cause:t});if(s.rpId!==e)return new tJ({message:'The RP ID "'.concat(s.rpId,'" is invalid for this domain'),code:"ERROR_INVALID_RP_ID",cause:t})}else if("UnknownError"===t.name)return new tJ({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t});return new tJ({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}({error:t,options:e})}}}let tZ={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},t0={userVerification:"preferred",hints:["security-key"]};function t1(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let s=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),i=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),n={};for(let e of t)if(e)for(let t in e){let r=e[t];if(void 0!==r)if(Array.isArray(r))n[t]=r;else if(i(r))n[t]=r;else if(s(r)){let e=n[t];s(e)?n[t]=t1(e,r):n[t]=t1(r)}else n[t]=r}return n}class t2{async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge(e,t){let{factorId:r,webauthn:s,friendlyName:i,signal:n}=e;try{var a,o,l,c;let{data:e,error:u}=await this.client.mfa.challenge({factorId:r,webauthn:s});if(!e)return{data:null,error:u};let h=null!=n?n:tz.createNewAbortSignal();if("create"===e.webauthn.type){let{user:t}=e.webauthn.credential_options.publicKey;t.name||(t.name="".concat(t.id,":").concat(i)),t.displayName||(t.displayName=t.name)}switch(e.webauthn.type){case"create":{let s=(a=e.webauthn.credential_options.publicKey,o=null==t?void 0:t.create,t1(tZ,a,o||{})),{data:i,error:n}=await tX({publicKey:s,signal:h});if(i)return{data:{factorId:r,challengeId:e.id,webauthn:{type:e.webauthn.type,credential_response:i}},error:null};return{data:null,error:n}}case"request":{let s=(l=e.webauthn.credential_options.publicKey,c=null==t?void 0:t.request,t1(t0,l,c||{})),{data:i,error:n}=await tQ(Object.assign(Object.assign({},e.webauthn.credential_options),{publicKey:s,signal:h}));if(i)return{data:{factorId:r,challengeId:e.id,webauthn:{type:e.webauthn.type,credential_response:i}},error:null};return{data:null,error:n}}}}catch(e){if(eX(e))return{data:null,error:e};return{data:null,error:new eZ("Unexpected error in challenge",e)}}}async _verify(e){let{challengeId:t,factorId:r,webauthn:s}=e;return this.client.mfa.verify({factorId:r,challengeId:t,webauthn:s})}async _authenticate(e,t){let{factorId:r,webauthn:{rpId:s="undefined"!=typeof window?window.location.hostname:void 0,rpOrigins:i="undefined"!=typeof window?[window.location.origin]:void 0,signal:n}}=e;if(!s)return{data:null,error:new e$("rpId is required for WebAuthn authentication")};try{if(!t$())return{data:null,error:new eZ("Browser does not support WebAuthn",null)};let{data:e,error:a}=await this.challenge({factorId:r,webauthn:{rpId:s,rpOrigins:i},signal:n},{request:t});if(!e)return{data:null,error:a};let{webauthn:o}=e;return this._verify({factorId:r,challengeId:e.challengeId,webauthn:{type:o.type,rpId:s,rpOrigins:i,credential_response:o.credential_response}})}catch(e){if(eX(e))return{data:null,error:e};return{data:null,error:new eZ("Unexpected error in authenticate",e)}}}async _register(e,t){let{friendlyName:r,rpId:s="undefined"!=typeof window?window.location.hostname:void 0,rpOrigins:i="undefined"!=typeof window?[window.location.origin]:void 0,signal:n}=e;if(!s)return{data:null,error:new e$("rpId is required for WebAuthn registration")};try{if(!t$())return{data:null,error:new eZ("Browser does not support WebAuthn",null)};let{data:e,error:a}=await this._enroll({friendlyName:r});if(!e)return await this.client.mfa.listFactors().then(e=>{var t;return null==(t=e.data)?void 0:t.all.find(e=>"webauthn"===e.factor_type&&e.friendly_name===r&&"unverified"!==e.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:a};let{data:o,error:l}=await this._challenge({factorId:e.id,friendlyName:e.friendly_name,webauthn:{rpId:s,rpOrigins:i},signal:n},{create:t});if(!o)return{data:null,error:l};return this._verify({factorId:e.id,challengeId:o.challengeId,webauthn:{rpId:s,rpOrigins:i,type:o.webauthn.type,credential_response:o.webauthn.credential_response}})}catch(e){if(eX(e))return{data:null,error:e};return{data:null,error:new eZ("Unexpected error in register",e)}}}constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}}if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}let t5={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:{"X-Client-Info":"gotrue-js/".concat(eJ)},flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function t6(e,t,r){return await r()}let t8={};class t3{get jwks(){var e,t;return null!=(t=null==(e=t8[this.storageKey])?void 0:e.jwks)?t:{keys:[]}}set jwks(e){t8[this.storageKey]=Object.assign(Object.assign({},t8[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!=(t=null==(e=t8[this.storageKey])?void 0:e.cachedAt)?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){t8[this.storageKey]=Object.assign(Object.assign({},t8[this.storageKey]),{cachedAt:e})}_debug(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.logDebugMessages&&this.logger("GoTrueClient@".concat(this.instanceID," (").concat(eJ,") ").concat(new Date().toISOString()),...t),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t=function(e){let t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((e,r)=>{t[r]=e})}catch(e){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}(window.location.href),r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),tl()&&this.detectSessionInUrl&&"none"!==r){let{data:s,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),eX(i)&&"AuthImplicitGrantRedirectError"===i.name){let t=null==(e=i.details)?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:i}}return await this._removeSession(),{error:i}}let{session:n,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",n,"redirect type",a),await this._saveSession(n),setTimeout(async()=>{"recovery"===a?await this._notifyAllSubscribers("PASSWORD_RECOVERY",n):await this._notifyAllSubscribers("SIGNED_IN",n)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){if(eX(e))return{error:e};return{error:new eZ("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{let{data:i,error:n}=await tI(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{data:null!=(r=null==(t=null==e?void 0:e.options)?void 0:t.data)?r:{},gotrue_meta_security:{captcha_token:null==(s=null==e?void 0:e.options)?void 0:s.captchaToken}},xform:tC});if(n||!i)return{data:{user:null,session:null},error:n};let a=i.session,o=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:o,session:a},error:null}}catch(e){if(eX(e))return{data:{user:null,session:null},error:e};throw e}}async signUp(e){var t,r,s;try{let i;if("email"in e){let{email:r,password:s,options:n}=e,a=null,o=null;"pkce"===this.flowType&&([a,o]=await tv(this.storage,this.storageKey)),i=await tI(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:{email:r,password:s,data:null!=(t=null==n?void 0:n.data)?t:{},gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:a,code_challenge_method:o},xform:tC})}else if("phone"in e){let{phone:t,password:n,options:a}=e;i=await tI(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{phone:t,password:n,data:null!=(r=null==a?void 0:a.data)?r:{},channel:null!=(s=null==a?void 0:a.channel)?s:"sms",gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:tC})}else throw new e5("You must provide either an email or phone number and a password");let{data:n,error:a}=i;if(a||!n)return{data:{user:null,session:null},error:a};let o=n.session,l=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(e){if(eX(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithPassword(e){try{let t;if("email"in e){let{email:r,password:s,options:i}=e;t=await tI(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:tx})}else if("phone"in e){let{phone:r,password:s,options:i}=e;t=await tI(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:tx})}else throw new e5("You must provide either an email or phone number and a password");let{data:r,error:s}=t;if(s)return{data:{user:null,session:null},error:s};if(!r||!r.session||!r.user)return{data:{user:null,session:null},error:new e2};return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s}}catch(e){if(eX(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(e){var t,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:null==(t=e.options)?void 0:t.redirectTo,scopes:null==(r=e.options)?void 0:r.scopes,queryParams:null==(s=e.options)?void 0:s.queryParams,skipBrowserRedirect:null==(i=e.options)?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){let{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw Error('@supabase/auth-js: Unsupported chain "'.concat(t,'"'))}}async signInWithEthereum(e){var t,r,s,i,n,a,o,l,c,u,h,d;let f,p;if("message"in e)f=e.message,p=e.signature;else{let u,{chain:h,wallet:g,statement:y,options:w}=e;if(tl())if("object"==typeof g)u=g;else{let e=window;if("ethereum"in e&&"object"==typeof e.ethereum&&"request"in e.ethereum&&"function"==typeof e.ethereum.request)u=e.ethereum;else throw Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if("object"!=typeof g||!(null==w?void 0:w.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");u=g}let m=new URL(null!=(t=null==w?void 0:w.url)?t:window.location.href),b=await u.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!b||0===b.length)throw Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");let _=tG(b[0]),v=null==(r=null==w?void 0:w.signInWithEthereum)?void 0:r.chainId;v||(v=parseInt(await u.request({method:"eth_chainId"}),16)),f=function(e){var t;let{chainId:r,domain:s,expirationTime:i,issuedAt:n=new Date,nonce:a,notBefore:o,requestId:l,resources:c,scheme:u,uri:h,version:d}=e;if(!Number.isInteger(r))throw Error('@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: '.concat(r));if(!s)throw Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw Error('@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: '.concat(a));if(!h)throw Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==d)throw Error("@supabase/auth-js: Invalid SIWE message field \"version\". Version must be '1'. Provided value: ".concat(d));if(null==(t=e.statement)?void 0:t.includes("\n"))throw Error("@supabase/auth-js: Invalid SIWE message field \"statement\". Statement must not include '\\n'. Provided value: ".concat(e.statement));let f=tG(e.address),p=u?"".concat(u,"://").concat(s):s,g=e.statement?"".concat(e.statement,"\n"):"",y="".concat(p," wants you to sign in with your Ethereum account:\n").concat(f,"\n\n").concat(g),w="URI: ".concat(h,"\nVersion: ").concat(d,"\nChain ID: ").concat(r).concat(a?"\nNonce: ".concat(a):"","\nIssued At: ").concat(n.toISOString());if(i&&(w+="\nExpiration Time: ".concat(i.toISOString())),o&&(w+="\nNot Before: ".concat(o.toISOString())),l&&(w+="\nRequest ID: ".concat(l)),c){let e="\nResources:";for(let t of c){if(!t||"string"!=typeof t)throw Error('@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: '.concat(t));e+="\n- ".concat(t)}w+=e}return"".concat(y,"\n").concat(w)}({domain:m.host,address:_,statement:y,uri:m.href,version:"1",chainId:v,nonce:null==(s=null==w?void 0:w.signInWithEthereum)?void 0:s.nonce,issuedAt:null!=(n=null==(i=null==w?void 0:w.signInWithEthereum)?void 0:i.issuedAt)?n:new Date,expirationTime:null==(a=null==w?void 0:w.signInWithEthereum)?void 0:a.expirationTime,notBefore:null==(o=null==w?void 0:w.signInWithEthereum)?void 0:o.notBefore,requestId:null==(l=null==w?void 0:w.signInWithEthereum)?void 0:l.requestId,resources:null==(c=null==w?void 0:w.signInWithEthereum)?void 0:c.resources}),p=await u.request({method:"personal_sign",params:[(d=f,"0x"+Array.from(new TextEncoder().encode(d),e=>e.toString(16).padStart(2,"0")).join("")),_]})}try{let{data:t,error:r}=await tI(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:p},(null==(u=e.options)?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null==(h=e.options)?void 0:h.captchaToken}}:null),xform:tC});if(r)throw r;if(!t||!t.session||!t.user)return{data:{user:null,session:null},error:new e2};return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:r}}catch(e){if(eX(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithSolana(e){var t,r,s,i,n,a,o,l,c,u,h,d;let f,p;if("message"in e)f=e.message,p=e.signature;else{let h,{chain:d,wallet:g,statement:y,options:w}=e;if(tl())if("object"==typeof g)h=g;else{let e=window;if("solana"in e&&"object"==typeof e.solana&&("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))h=e.solana;else throw Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if("object"!=typeof g||!(null==w?void 0:w.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");h=g}let m=new URL(null!=(t=null==w?void 0:w.url)?t:window.location.href);if("signIn"in h&&h.signIn){let e,t=await h.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},null==w?void 0:w.signInWithSolana),{version:"1",domain:m.host,uri:m.href}),y?{statement:y}:null));if(Array.isArray(t)&&t[0]&&"object"==typeof t[0])e=t[0];else if(t&&"object"==typeof t&&"signedMessage"in t&&"signature"in t)e=t;else throw Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in e&&"signature"in e&&("string"==typeof e.signedMessage||e.signedMessage instanceof Uint8Array)&&e.signature instanceof Uint8Array)f="string"==typeof e.signedMessage?e.signedMessage:new TextDecoder().decode(e.signedMessage),p=e.signature;else throw Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in h)||"function"!=typeof h.signMessage||!("publicKey"in h)||"object"!=typeof h||!h.publicKey||!("toBase58"in h.publicKey)||"function"!=typeof h.publicKey.toBase58)throw Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=["".concat(m.host," wants you to sign in with your Solana account:"),h.publicKey.toBase58(),...y?["",y,""]:[""],"Version: 1","URI: ".concat(m.href),"Issued At: ".concat(null!=(s=null==(r=null==w?void 0:w.signInWithSolana)?void 0:r.issuedAt)?s:new Date().toISOString()),...(null==(i=null==w?void 0:w.signInWithSolana)?void 0:i.notBefore)?["Not Before: ".concat(w.signInWithSolana.notBefore)]:[],...(null==(n=null==w?void 0:w.signInWithSolana)?void 0:n.expirationTime)?["Expiration Time: ".concat(w.signInWithSolana.expirationTime)]:[],...(null==(a=null==w?void 0:w.signInWithSolana)?void 0:a.chainId)?["Chain ID: ".concat(w.signInWithSolana.chainId)]:[],...(null==(o=null==w?void 0:w.signInWithSolana)?void 0:o.nonce)?["Nonce: ".concat(w.signInWithSolana.nonce)]:[],...(null==(l=null==w?void 0:w.signInWithSolana)?void 0:l.requestId)?["Request ID: ".concat(w.signInWithSolana.requestId)]:[],...(null==(u=null==(c=null==w?void 0:w.signInWithSolana)?void 0:c.resources)?void 0:u.length)?["Resources",...w.signInWithSolana.resources.map(e=>"- ".concat(e))]:[]].join("\n");let e=await h.signMessage(new TextEncoder().encode(f),"utf8");if(!e||!(e instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{let{data:t,error:r}=await tI(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:to(p)},(null==(h=e.options)?void 0:h.captchaToken)?{gotrue_meta_security:{captcha_token:null==(d=e.options)?void 0:d.captchaToken}}:null),xform:tC});if(r)throw r;if(!t||!t.session||!t.user)return{data:{user:null,session:null},error:new e2};return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:r}}catch(e){if(eX(e))return{data:{user:null,session:null},error:e};throw e}}async _exchangeCodeForSession(e){let t=await tf(this.storage,"".concat(this.storageKey,"-code-verifier")),[r,s]=(null!=t?t:"").split("/");try{let{data:t,error:i}=await tI(this.fetch,"POST","".concat(this.url,"/token?grant_type=pkce"),{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:tC});if(await tp(this.storage,"".concat(this.storageKey,"-code-verifier")),i)throw i;if(!t||!t.session||!t.user)return{data:{user:null,session:null,redirectType:null},error:new e2};return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=s?s:null}),error:i}}catch(e){if(eX(e))return{data:{user:null,session:null,redirectType:null},error:e};throw e}}async signInWithIdToken(e){try{let{options:t,provider:r,token:s,access_token:i,nonce:n}=e,{data:a,error:o}=await tI(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:n,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:tC});if(o)return{data:{user:null,session:null},error:o};if(!a||!a.session||!a.user)return{data:{user:null,session:null},error:new e2};return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:o}}catch(e){if(eX(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(e){var t,r,s,i,n;try{if("email"in e){let{email:s,options:i}=e,n=null,a=null;"pkce"===this.flowType&&([n,a]=await tv(this.storage,this.storageKey));let{error:o}=await tI(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{email:s,data:null!=(t=null==i?void 0:i.data)?t:{},create_user:null==(r=null==i?void 0:i.shouldCreateUser)||r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:n,code_challenge_method:a},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){let{phone:t,options:r}=e,{data:a,error:o}=await tI(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{phone:t,data:null!=(s=null==r?void 0:r.data)?s:{},create_user:null==(i=null==r?void 0:r.shouldCreateUser)||i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!=(n=null==r?void 0:r.channel)?n:"sms"}});return{data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:o}}throw new e5("You must provide either an email or phone number.")}catch(e){if(eX(e))return{data:{user:null,session:null},error:e};throw e}}async verifyOtp(e){var t,r;try{let s,i;"options"in e&&(s=null==(t=e.options)?void 0:t.redirectTo,i=null==(r=e.options)?void 0:r.captchaToken);let{data:n,error:a}=await tI(this.fetch,"POST","".concat(this.url,"/verify"),{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:tC});if(a)throw a;if(!n)throw Error("An error occurred on token verification.");let o=n.session,l=n.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(e){if(eX(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithSSO(e){var t,r,s;try{let i=null,n=null;return"pkce"===this.flowType&&([i,n]=await tv(this.storage,this.storageKey)),await tI(this.fetch,"POST","".concat(this.url,"/sso"),{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!=(r=null==(t=e.options)?void 0:t.redirectTo)?r:void 0}),(null==(s=null==e?void 0:e.options)?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:n}),headers:this.headers,xform:tN})}catch(e){if(eX(e))return{data:null,error:e};throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new e1;let{error:s}=await tI(this.fetch,"GET","".concat(this.url,"/reauthenticate"),{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(eX(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{let t="".concat(this.url,"/resend");if("email"in e){let{email:r,type:s,options:i}=e,{error:n}=await tI(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:n}}if("phone"in e){let{phone:r,type:s,options:i}=e,{data:n,error:a}=await tI(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:a}}throw new e5("You must provide either an email or phone number and a type")}catch(e){if(eX(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock("lock:".concat(this.storageKey),e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){let e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let e=null,t=await tf(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let r=!!e.expires_at&&1e3*e.expires_at-Date.now()<9e4;if(this._debug("#__loadSession()","session has".concat(r?"":" not"," expired"),"expires_at",e.expires_at),!r){if(this.userStorage){let t=await tf(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=tT()}if(this.storage.isServer&&e.user){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,r,s)=>(t||"user"!==r||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,r,s))})}return{data:{session:e},error:null}}let{data:s,error:i}=await this._callRefreshToken(e.refresh_token);if(i)return{data:{session:null},error:i};return{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{if(e)return await tI(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:e,xform:tU});return await this._useSession(async e=>{var t,r,s;let{data:i,error:n}=e;if(n)throw n;return(null==(t=i.session)?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await tI(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:null!=(s=null==(r=i.session)?void 0:r.access_token)?s:void 0,xform:tU}):{data:{user:null},error:new e1}})}catch(e){if(eX(e))return eX(e)&&"AuthSessionMissingError"===e.name&&(await this._removeSession(),await tp(this.storage,"".concat(this.storageKey,"-code-verifier"))),{data:{user:null},error:e};throw e}}async updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await this._useSession(async r=>{let{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new e1;let n=s.session,a=null,o=null;"pkce"===this.flowType&&null!=e.email&&([a,o]=await tv(this.storage,this.storageKey));let{data:l,error:c}=await tI(this.fetch,"PUT","".concat(this.url,"/user"),{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:o}),jwt:n.access_token,xform:tU});if(c)throw c;return n.user=l.user,await this._saveSession(n),await this._notifyAllSubscribers("USER_UPDATED",n),{data:{user:n.user},error:null}})}catch(e){if(eX(e))return{data:{user:null},error:e};throw e}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new e1;let t=Date.now()/1e3,r=t,s=!0,i=null,{payload:n}=ty(e.access_token);if(n.exp&&(s=(r=n.exp)<=t),s){let{data:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!t)return{data:{user:null,session:null},error:null};i=t}else{let{data:s,error:n}=await this._getUser(e.access_token);if(n)throw n;i={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(e){if(eX(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){let{data:s,error:i}=t;if(i)throw i;e=null!=(r=s.session)?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new e1;let{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(e){if(eX(e))return{data:{user:null,session:null},error:e};throw e}}async _getSessionFromURL(e,t){try{if(!tl())throw new e6("No browser detected.");if(e.error||e.error_description||e.error_code)throw new e6(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new e8("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new e6("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new e8("No code detected.");let{data:t,error:r}=await this._exchangeCodeForSession(e.code);if(r)throw r;let s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:t.session,redirectType:null},error:null}}let{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:n,expires_in:a,expires_at:o,token_type:l}=e;if(!i||!a||!n||!l)throw new e6("No session defined in URL");let c=Math.round(Date.now()/1e3),u=parseInt(a),h=c+u;o&&(h=parseInt(o));let d=h-c;1e3*d<=3e4&&console.warn("@supabase/gotrue-js: Session as retrieved from URL expires in ".concat(d,"s, should have been closer to ").concat(u,"s"));let f=h-u;c-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,h,c):c-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,h,c);let{data:p,error:g}=await this._getUser(i);if(g)throw g;let y={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:u,expires_at:h,refresh_token:n,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:e.type},error:null}}catch(e){if(eX(e))return{data:{session:null,redirectType:null},error:e};throw e}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){let t=await tf(this.storage,"".concat(this.storageKey,"-code-verifier"));return!!(e.code&&t)}async signOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut(){let{scope:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this._useSession(async t=>{var r;let{data:s,error:i}=t;if(i)return{error:i};let n=null==(r=s.session)?void 0:r.access_token;if(n){let{error:t}=await this.admin.signOut(n,e);if(t&&!(eX(t)&&"AuthApiError"===t.name&&(404===t.status||401===t.status||403===t.status)))return{error:t}}return"others"!==e&&(await this._removeSession(),await tp(this.storage,"".concat(this.storageKey,"-code-verifier"))),{error:null}})}onAuthStateChange(e){let t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{let{data:{session:s},error:i}=t;if(i)throw i;await (null==(r=this.stateChangeEmitters.get(e))?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(t){await (null==(s=this.stateChangeEmitters.get(e))?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}})}async resetPasswordForEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=null,s=null;"pkce"===this.flowType&&([r,s]=await tv(this.storage,this.storageKey,!0));try{return await tI(this.fetch,"POST","".concat(this.url,"/recover"),{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(eX(e))return{data:null,error:e};throw e}}async getUserIdentities(){var e;try{let{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:null!=(e=t.user.identities)?e:[]},error:null}}catch(e){if(eX(e))return{data:null,error:e};throw e}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{let{data:r,error:s}=await this._useSession(async t=>{var r,s,i,n,a;let{data:o,error:l}=t;if(l)throw l;let c=await this._getUrlForProvider("".concat(this.url,"/user/identities/authorize"),e.provider,{redirectTo:null==(r=e.options)?void 0:r.redirectTo,scopes:null==(s=e.options)?void 0:s.scopes,queryParams:null==(i=e.options)?void 0:i.queryParams,skipBrowserRedirect:!0});return await tI(this.fetch,"GET",c,{headers:this.headers,jwt:null!=(a=null==(n=o.session)?void 0:n.access_token)?a:void 0})});if(s)throw s;return!tl()||(null==(t=e.options)?void 0:t.skipBrowserRedirect)||window.location.assign(null==r?void 0:r.url),{data:{provider:e.provider,url:null==r?void 0:r.url},error:null}}catch(t){if(eX(t))return{data:{provider:e.provider,url:null},error:t};throw t}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var r;try{let{error:s,data:{session:i}}=t;if(s)throw s;let{options:n,provider:a,token:o,access_token:l,nonce:c}=e,{data:u,error:h}=await tI(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,jwt:null!=(r=null==i?void 0:i.access_token)?r:void 0,body:{provider:a,id_token:o,access_token:l,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:tC});if(h)return{data:{user:null,session:null},error:h};if(!u||!u.session||!u.user)return{data:{user:null,session:null},error:new e2};return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("USER_UPDATED",u.session)),{data:u,error:h}}catch(e){if(eX(e))return{data:{user:null,session:null},error:e};throw e}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;let{data:i,error:n}=t;if(n)throw n;return await tI(this.fetch,"DELETE","".concat(this.url,"/user/identities/").concat(e.identity_id),{headers:this.headers,jwt:null!=(s=null==(r=i.session)?void 0:r.access_token)?s:void 0})})}catch(e){if(eX(e))return{data:null,error:e};throw e}}async _refreshAccessToken(e){let t="#_refreshAccessToken(".concat(e.substring(0,5),"...)");this._debug(t,"begin");try{var r,s;let i=Date.now();return await (r=async r=>(r>0&&await tw(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await tI(this.fetch,"POST","".concat(this.url,"/token?grant_type=refresh_token"),{body:{refresh_token:e},headers:this.headers,xform:tC})),s=(e,t)=>{let r=200*Math.pow(2,e);return t&&e4(t)&&Date.now()+r-i<3e4},new Promise((e,t)=>{(async()=>{for(let i=0;i<1/0;i++)try{let t=await r(i);if(!s(i,null,t))return void e(t)}catch(e){if(!s(i,e))return void t(e)}})()}))}catch(e){if(this._debug(t,"error",e),eX(e))return{data:{session:null,user:null},error:e};throw e}finally{this._debug(t,"end")}}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){let r=await this._getUrlForProvider("".concat(this.url,"/authorize"),e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),tl()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;let r="#_recoverAndRefresh()";this._debug(r,"begin");try{let s=await tf(this.storage,this.storageKey);if(s&&this.userStorage){let t=await tf(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!t&&(t={user:s.user},await td(this.userStorage,this.storageKey+"-user",t)),s.user=null!=(e=null==t?void 0:t.user)?e:tT()}else if(s&&!s.user&&!s.user){let e=await tf(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(s.user=e.user,await tp(this.storage,this.storageKey+"-user"),await td(this.storage,this.storageKey,s)):s.user=tT()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),null!==s&&await this._removeSession();return}let i=(null!=(t=s.expires_at)?t:1/0)*1e3-Date.now()<9e4;if(this._debug(r,"session has".concat(i?"":" not"," expired with margin of ").concat(9e4,"s")),i){if(this.autoRefreshToken&&s.refresh_token){let{error:e}=await this._callRefreshToken(s.refresh_token);e&&(console.error(e),e4(e)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(s.user&&!0===s.user.__isUserNotAvailableProxy)try{let{data:e,error:t}=await this._getUser(s.access_token);!t&&(null==e?void 0:e.user)?(s.user=e.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(e){console.error("Error getting user data:",e),this._debug(r,"error getting user data, skipping SIGNED_IN notification",e)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(e){this._debug(r,"error",e),console.error(e);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new e1;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let s="#_callRefreshToken(".concat(e.substring(0,5),"...)");this._debug(s,"begin");try{this.refreshingDeferred=new tg;let{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new e1;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);let s={data:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(e){if(this._debug(s,"error",e),eX(e)){let r={data:null,error:e};return e4(e)||await this._removeSession(),null==(t=this.refreshingDeferred)||t.resolve(r),r}throw null==(r=this.refreshingDeferred)||r.reject(e),e}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],s="#_notifyAllSubscribers(".concat(e,")");this._debug(s,"begin",t,"broadcast = ".concat(r));try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});let s=[],i=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(e){s.push(e)}});if(await Promise.all(i),s.length>0){for(let e=0;e<s.length;e+=1)console.error(s[e]);throw s[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;let t=Object.assign({},e),r=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!r&&t.user&&await td(this.userStorage,this.storageKey+"-user",{user:t.user});let e=Object.assign({},t);delete e.user;let s=tO(e);await td(this.storage,this.storageKey,s)}else{let e=tO(t);await td(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),await tp(this.storage,this.storageKey),await tp(this.storage,this.storageKey+"-code-verifier"),await tp(this.storage,this.storageKey+"-user"),this.userStorage&&await tp(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&tl()&&(null==window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),3e4);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async t=>{let{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");let s=Math.floor((1e3*r.expires_at-e)/3e4);this._debug("#_autoRefreshTokenTick()","access token expires in ".concat(s," ticks, a tick lasts ").concat(3e4,"ms, refresh threshold is ").concat(3," ticks")),s<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof tV)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!tl()||!(null==window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null==window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let t="#_onVisibilityChanged(".concat(e,")");this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if("visible"!==document.visibilityState)return void this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");await this._recoverAndRefresh()}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){let s=["provider=".concat(encodeURIComponent(t))];if((null==r?void 0:r.redirectTo)&&s.push("redirect_to=".concat(encodeURIComponent(r.redirectTo))),(null==r?void 0:r.scopes)&&s.push("scopes=".concat(encodeURIComponent(r.scopes))),"pkce"===this.flowType){let[e,t]=await tv(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:"".concat(encodeURIComponent(e)),code_challenge_method:"".concat(encodeURIComponent(t))});s.push(r.toString())}if(null==r?void 0:r.queryParams){let e=new URLSearchParams(r.queryParams);s.push(e.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&s.push("skip_http_redirect=".concat(r.skipBrowserRedirect)),"".concat(e,"?").concat(s.join("&"))}async _unenroll(e){try{return await this._useSession(async t=>{var r;let{data:s,error:i}=t;return i?{data:null,error:i}:await tI(this.fetch,"DELETE","".concat(this.url,"/factors/").concat(e.factorId),{headers:this.headers,jwt:null==(r=null==s?void 0:s.session)?void 0:r.access_token})})}catch(e){if(eX(e))return{data:null,error:e};throw e}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;let{data:i,error:n}=t;if(n)return{data:null,error:n};let a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:o,error:l}=await tI(this.fetch,"POST","".concat(this.url,"/factors"),{body:a,headers:this.headers,jwt:null==(r=null==i?void 0:i.session)?void 0:r.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&"totp"===o.type&&(null==(s=null==o?void 0:o.totp)?void 0:s.qr_code)&&(o.totp.qr_code="data:image/svg+xml;utf-8,".concat(o.totp.qr_code)),{data:o,error:null})})}catch(e){if(eX(e))return{data:null,error:e};throw e}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r,s,i;let{data:n,error:a}=t;if(a)return{data:null,error:a};let o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?(s=e.webauthn.credential_response,"toJSON"in s&&"function"==typeof s.toJSON?s.toJSON():{id:s.id,rawId:s.id,response:{attestationObject:to(new Uint8Array(s.response.attestationObject)),clientDataJSON:to(new Uint8Array(s.response.clientDataJSON))},type:"public-key",clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:null!=(i=s.authenticatorAttachment)?i:void 0}):function(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();let r=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:to(new Uint8Array(s.authenticatorData)),clientDataJSON:to(new Uint8Array(s.clientDataJSON)),signature:to(new Uint8Array(s.signature)),userHandle:s.userHandle?to(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:null!=(t=e.authenticatorAttachment)?t:void 0}}(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:c}=await tI(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/verify"),{body:o,headers:this.headers,jwt:null==(r=null==n?void 0:n.session)?void 0:r.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),{data:l,error:c})})}catch(e){if(eX(e))return{data:null,error:e};throw e}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;let{data:s,error:i}=t;if(i)return{data:null,error:i};let n=await tI(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/challenge"),{body:e,headers:this.headers,jwt:null==(r=null==s?void 0:s.session)?void 0:r.access_token});if(n.error)return n;let{data:a}=n;if("webauthn"!==a.type)return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:function(e){if(!e)throw Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);let{challenge:t,user:r,excludeCredentials:s}=e,i=(0,E.__rest)(e,["challenge","user","excludeCredentials"]),n=ta(t).buffer,a=Object.assign(Object.assign({},r),{id:ta(r.id).buffer}),o=Object.assign(Object.assign({},i),{challenge:n,user:a});if(s&&s.length>0){o.excludeCredentials=Array(s.length);for(let e=0;e<s.length;e++){let t=s[e];o.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:ta(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return o}(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:function(e){if(!e)throw Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);let{challenge:t,allowCredentials:r}=e,s=(0,E.__rest)(e,["challenge","allowCredentials"]),i=ta(t).buffer,n=Object.assign(Object.assign({},s),{challenge:i});if(r&&r.length>0){n.allowCredentials=Array(r.length);for(let e=0;e<r.length;e++){let t=r[e];n.allowCredentials[e]=Object.assign(Object.assign({},t),{id:ta(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return n}(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(eX(e))return{data:null,error:e};throw e}})}async _challengeAndVerify(e){let{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;let{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};let s={all:[],phone:[],totp:[],webauthn:[]};for(let r of null!=(e=null==t?void 0:t.factors)?e:[])s.all.push(r),"verified"===r.status&&s[r.factor_type].push(r);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;let{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:n}=ty(s.access_token),a=null;n.aal&&(a=n.aal);let o=a;return(null!=(r=null==(t=s.user.factors)?void 0:t.filter(e=>"verified"===e.status))?r:[]).length>0&&(o="aal2"),{data:{currentLevel:a,nextLevel:o,currentAuthenticationMethods:n.amr||[]},error:null}}))}async fetchJwk(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{keys:[]},r=t.keys.find(t=>t.kid===e);if(r)return r;let s=Date.now();if((r=this.jwks.keys.find(t=>t.kid===e))&&this.jwks_cached_at+6e5>s)return r;let{data:i,error:n}=await tI(this.fetch,"GET","".concat(this.url,"/.well-known/jwks.json"),{headers:this.headers});if(n)throw n;return i.keys&&0!==i.keys.length&&(this.jwks=i,this.jwks_cached_at=s,r=i.keys.find(t=>t.kid===e))?r:null}async getClaims(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let r=e;if(!r){let{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};r=e.session.access_token}let{header:s,payload:i,signature:n,raw:{header:a,payload:o}}=ty(r);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw Error("JWT has expired")}(i.exp);let l=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks);if(!l){let{error:e}=await this.getUser(r);if(e)throw e;return{data:{claims:i,header:s,signature:n},error:null}}let c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw Error("Invalid alg claim")}}(s.alg),u=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!await crypto.subtle.verify(c,u,n,function(e){let t=[];return!function(e,t){for(let r=0;r<e.length;r+=1){let s=e.charCodeAt(r);if(s>55295&&s<=56319){let t=(s-55296)*1024&65535;s=(e.charCodeAt(r+1)-56320&65535|t)+65536,r+=1}!function(e,t){if(e<=127)return t(e);if(e<=2047){t(192|e>>6),t(128|63&e);return}if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|63&e);return}if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|63&e);return}throw Error("Unrecognized Unicode codepoint: ".concat(e.toString(16)))}(s,t)}}(e,e=>t.push(e)),new Uint8Array(t)}("".concat(a,".").concat(o))))throw new e7("Invalid JWT signature");return{data:{claims:i,header:s,signature:n},error:null}}catch(e){if(eX(e))return{data:null,error:e};throw e}}constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=t3.nextInstanceID,t3.nextInstanceID+=1,this.instanceID>0&&tl()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let s=Object.assign(Object.assign({},t5),e);if(this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new tD({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=th(s.fetch),this.lock=s.lock||t6,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:tl()&&(null==(t=null==globalThis?void 0:globalThis.navigator)?void 0:t.locks)?this.lock=tF:this.lock=t6,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new t2(this)},this.persistSession?(s.storage?this.storage=s.storage:tu()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=tM(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=tM(this.memoryStorage)),tl()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null==(r=this.broadcastChannel)||r.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}}t3.nextInstanceID=0;let t4=t3;class t9 extends t4{constructor(e){super(e)}}class t7{get functions(){return new R(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{head:!1,get:!1,count:void 0};return this.rest.rpc(e,t,r)}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();let{data:r}=await this.auth.getSession();return null!=(t=null==(e=r.session)?void 0:e.access_token)?t:this.supabaseKey}_initSupabaseAuthClient(e,t,r){let{autoRefreshToken:s,persistSession:i,detectSessionInUrl:n,storage:a,userStorage:o,storageKey:l,flowType:c,lock:u,debug:h}=e,d={Authorization:"Bearer ".concat(this.supabaseKey),apikey:"".concat(this.supabaseKey)};return new t9({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),t),storageKey:l,autoRefreshToken:s,persistSession:i,detectSessionInUrl:n,storage:a,userStorage:o,flowType:c,lock:u,debug:h,fetch:r,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new er(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){("TOKEN_REFRESHED"===e||"SIGNED_IN"===e)&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0)}constructor(e,t,r){var s,i,n;this.supabaseUrl=e,this.supabaseKey=t;let a=function(e){let t=null==e?void 0:e.trim();if(!t)throw Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(t.endsWith("/")?t:t+"/")}catch(e){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}(e);if(!t)throw Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);let o="sb-".concat(a.hostname.split(".")[0],"-auth-token"),l=function(e,t){var r,s;let{db:i,auth:n,realtime:a,global:o}=e,{db:l,auth:c,realtime:u,global:h}=t,d={db:Object.assign(Object.assign({},l),i),auth:Object.assign(Object.assign({},c),n),realtime:Object.assign(Object.assign({},u),a),storage:{},global:Object.assign(Object.assign(Object.assign({},h),o),{headers:Object.assign(Object.assign({},null!=(r=null==h?void 0:h.headers)?r:{}),null!=(s=null==o?void 0:o.headers)?s:{})}),accessToken:async()=>""};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=r?r:{},{db:eV,realtime:eF,auth:Object.assign(Object.assign({},eK),{storageKey:o}),global:eW});this.storageKey=null!=(s=l.auth.storageKey)?s:"",this.headers=null!=(i=l.global.headers)?i:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw Error("@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.".concat(String(t)," is not possible"))}})):this.auth=this._initSupabaseAuthClient(null!=(n=l.auth)?n:{},this.headers,l.global.fetch),this.fetch=((e,t,r)=>{let s=(e=>{let t;return t=e||("undefined"==typeof fetch?eG.default:fetch),function(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];return t(...r)}})(r),i="undefined"==typeof Headers?eG.Headers:Headers;return async(r,n)=>{var a;let o=null!=(a=await t())?a:e,l=new i(null==n?void 0:n.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization","Bearer ".concat(o)),s(r,Object.assign(Object.assign({},n),{headers:l}))}})(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.rest=new I(new URL("rest/v1",a).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new eD(this.storageUrl.href,this.headers,this.fetch,null==r?void 0:r.storage),l.accessToken||this._listenForAuthEvents()}}(function(){if("undefined"!=typeof window||void 0===S.default)return!1;let e=S.default.version;if(null==e)return!1;let t=e.match(/^v(\d+)\./);return!!t&&18>=parseInt(t[1],10)})()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");let re=null;function rt(){return(function(e){if(!e)throw Error("Supabase client is required for repository factory");return new c(e)})(function(){if(re)return re;let{url:e,anonKey:t}={url:"https://xtqwqrnongwhiukntlkn.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh0cXdxcm5vbmd3aGl1a250bGtuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1NjE0NjgsImV4cCI6MjA3NzEzNzQ2OH0.A0n5EqdcPdeZOghE-s6-BGha8x087kcG_mJitmUBYqU"};return re=new t7(e,t,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"}})}()).getOrderRepository()}async function rr(){try{let e=await fetch("/api/jwellery",{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-store"});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return(await e.json()).products||[]}catch(e){return[]}}async function rs(){try{let e=await fetch("/api/products",{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-store"});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return(await e.json()).products||[]}catch(e){return[]}}function ri(e){return{_id:e.id,orderId:e.id,user_id:e.user_id,total_amount:e.total_amount,status:e.status,billing_details:e.billing_address||e.shipping_address||{},payment_status:e.payment_status||"pending",payment_id:e.payment_id,payment_method:e.payment_method,order_items:e.items||[],tracking_number:e.tracking_number,notes:e.notes,created_at:e.created_at,updated_at:e.updated_at}}async function rn(){try{return(await rt().findAll(100,0)).map(ri)}catch(e){throw e}}async function ra(e){try{let t={user_id:e.user_id,items:e.order_items||[],total_amount:e.total_amount,status:e.status||"pending",payment_status:e.payment_status||"pending",payment_method:e.payment_method,shipping_address:e.billing_details,tracking_number:e.tracking_number,notes:e.notes},r=await rt().create(t);return ri(r)}catch(e){throw e}}}]);