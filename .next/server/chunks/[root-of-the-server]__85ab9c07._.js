module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},72783,e=>{"use strict";function t(e,t){let r=[];for(let s of t){let t=e[s.field];if(s.required&&(null==t||""===t)){r.push({field:s.field,message:s.message||`${s.field} is required`});continue}if(s.required||null!=t&&""!==t){if(s.type&&!function(e,t){switch(t){case"string":return"string"==typeof e;case"number":return"number"==typeof e&&!isNaN(e);case"boolean":return"boolean"==typeof e;case"email":return"string"==typeof e&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);case"url":try{return new URL(e),!0}catch{return!1}case"uuid":return"string"==typeof e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e);case"array":return Array.isArray(e);case"object":return"object"==typeof e&&null!==e&&!Array.isArray(e);default:return!0}}(t,s.type)){r.push({field:s.field,message:s.message||`${s.field} must be a valid ${s.type}`});continue}if(void 0!==s.min||void 0!==s.max){let e="string"==typeof t?t.length:"number"==typeof t?t:0;void 0!==s.min&&e<s.min&&r.push({field:s.field,message:s.message||`${s.field} must be at least ${s.min}`}),void 0!==s.max&&e>s.max&&r.push({field:s.field,message:s.message||`${s.field} must be at most ${s.max}`})}s.pattern&&"string"==typeof t&&!s.pattern.test(t)&&r.push({field:s.field,message:s.message||`${s.field} format is invalid`}),s.custom&&!s.custom(t)&&r.push({field:s.field,message:s.message||`${s.field} validation failed`})}}return{valid:0===r.length,errors:r}}e.s(["validateInput",()=>t])},93441,(e,t,r)=>{},76950,e=>{"use strict";e.s(["handler",()=>T,"patchFetch",()=>k,"routeModule",()=>q,"serverHooks",()=>P,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>C],76950);var t=e.i(47909),r=e.i(74017),s=e.i(96250),i=e.i(59756),a=e.i(61916),n=e.i(69741),o=e.i(16795),d=e.i(87718),u=e.i(95169),l=e.i(47587),c=e.i(66012),p=e.i(70101),m=e.i(26937),g=e.i(10372),f=e.i(93695);e.i(52474);var y=e.i(5232);e.s(["DELETE",()=>N,"GET",()=>_,"POST",()=>E,"PUT",()=>A],60265);var R=e.i(89171),h=e.i(48606),x=e.i(3848),v=e.i(38339),w=e.i(72783);async function _(e){try{let t,{user:r,supabase:s,error:i}=await (0,h.getAuthenticatedUser)(e);if(i||!r||!(0,h.isAdminRole)(r.role))return R.NextResponse.json({error:i||"Forbidden - Admin access required"},{status:i?401:403});let a=(0,x.getRepositoryFactory)(s).getGemRepository(),n=e.nextUrl.searchParams,o=n.get("search")||void 0,d=n.get("minPrice")?parseFloat(n.get("minPrice")):void 0,u=n.get("maxPrice")?parseFloat(n.get("maxPrice")):void 0,l=n.get("isActive")?"true"===n.get("isActive"):void 0,c=parseInt(n.get("limit")||"50"),p=parseInt(n.get("offset")||"0");return t=o?await a.searchGems(o,c):d||u||void 0!==l?await a.findGemsWithFilters({minPrice:d,maxPrice:u,isActive:l},c,p):await a.findAll(c,p),R.NextResponse.json({gems:t},{status:200})}catch(e){return R.NextResponse.json({error:e.message||"Failed to fetch gems"},{status:500})}}async function E(e){try{let t=(0,v.getRateLimitIdentifier)(e);if(!(await v.rateLimiters.api(t)).success)return R.NextResponse.json({error:"Too many requests. Please try again later."},{status:429});let{user:r,supabase:s,error:i}=await (0,h.getAuthenticatedUser)(e);if(i||!r||!(0,h.isHighAdminRole)(r.role))return R.NextResponse.json({error:i||"Forbidden - Admin access required"},{status:i?401:403});let a=(0,h.enforceCsrf)(e);if(!a.ok)return R.NextResponse.json({error:a.error},{status:403});let n=(0,x.getRepositoryFactory)(s).getGemRepository(),o=(0,x.getRepositoryFactory)(s).getAuditLogRepository(),d=await e.json(),u=(0,w.validateInput)(d,[{field:"name",type:"string",required:!0},{field:"price",type:"number",required:!0,min:0,max:1e7},{field:"identification",type:"string",required:!1},{field:"weight_carats",type:"string",required:!1},{field:"color",type:"string",required:!1},{field:"clarity",type:"string",required:!1},{field:"shape_and_cut",type:"string",required:!1},{field:"dimensions",type:"string",required:!1},{field:"treatments",type:"string",required:!1},{field:"origin",type:"string",required:!1},{field:"stock_quantity",type:"number",required:!1,min:0,max:1e5}]);if(!u.valid)return R.NextResponse.json({error:`Validation failed: ${u.errors.map(e=>e.message).join(", ")}`},{status:400});let l={name:d.name,price:d.price,identification:d.identification,weight_carats:d.weight_carats,color:d.color,clarity:d.clarity,shape_and_cut:d.shape_and_cut,dimensions:d.dimensions,treatments:d.treatments,origin:d.origin,images:d.images||[],stock_quantity:d.stock_quantity||0,is_active:void 0===d.is_active||d.is_active},c=await n.create(l);return await o.create({user_id:r.id,action:"CREATE_GEM",entity_type:"gem",entity_id:c.id,changes:{gemName:c.name,price:c.price,origin:c.origin}}),R.NextResponse.json(c,{status:201})}catch(e){return R.NextResponse.json({error:e.message||"Failed to create gem"},{status:500})}}async function A(e){try{let{user:t,supabase:r,error:s}=await (0,h.getAuthenticatedUser)(e);if(s||!t||!(0,h.isHighAdminRole)(t.role))return R.NextResponse.json({error:s||"Forbidden - Admin access required"},{status:s?401:403});let i=(0,h.enforceCsrf)(e);if(!i.ok)return R.NextResponse.json({error:i.error},{status:403});let a=(0,x.getRepositoryFactory)(r).getGemRepository(),n=(0,x.getRepositoryFactory)(r).getAuditLogRepository(),o=await e.json();if(!o.id)return R.NextResponse.json({error:"Gem ID is required"},{status:400});if(!await a.findById(o.id))return R.NextResponse.json({error:"Gem not found"},{status:404});if(void 0!==o.price&&("number"!=typeof o.price||o.price<0))return R.NextResponse.json({error:"Price must be a non-negative number"},{status:400});if(void 0!==o.stock_quantity&&("number"!=typeof o.stock_quantity||o.stock_quantity<0))return R.NextResponse.json({error:"Stock quantity must be a non-negative number"},{status:400});let d={};["name","price","identification","weight_carats","color","clarity","shape_and_cut","dimensions","treatments","origin","images","stock_quantity","is_active"].forEach(e=>{void 0!==o[e]&&(d[e]=o[e])});let u=await a.update(o.id,d);if(!u)return R.NextResponse.json({error:"Failed to update gem"},{status:500});return await n.create({user_id:t.id,action:"UPDATE_GEM",entity_type:"gem",entity_id:u.id,changes:{gemName:u.name,updatedFields:Object.keys(d)}}),R.NextResponse.json(u,{status:200})}catch(e){return R.NextResponse.json({error:e.message||"Failed to update gem"},{status:500})}}async function N(e){try{let{user:t,supabase:r,error:s}=await (0,h.getAuthenticatedUser)(e);if(s||!t||!(0,h.isHighAdminRole)(t.role))return R.NextResponse.json({error:s||"Forbidden - Admin access required"},{status:s?401:403});let i=(0,h.enforceCsrf)(e);if(!i.ok)return R.NextResponse.json({error:i.error},{status:403});let a=(0,x.getRepositoryFactory)(r).getGemRepository(),n=(0,x.getRepositoryFactory)(r).getAuditLogRepository(),o=e.nextUrl.searchParams.get("id");if(!o)return R.NextResponse.json({error:"Gem ID is required"},{status:400});let d=await a.findById(o);if(!d)return R.NextResponse.json({error:"Gem not found"},{status:404});if(!await a.delete(o))return R.NextResponse.json({error:"Failed to delete gem"},{status:500});return await n.create({user_id:t.id,action:"DELETE_GEM",entity_type:"gem",entity_id:o,changes:{gemName:d.name}}),R.NextResponse.json({message:"Gem deleted successfully"},{status:200})}catch(e){return R.NextResponse.json({error:e.message||"Failed to delete gem"},{status:500})}}var j=e.i(60265);let q=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/admin/gems/route",pathname:"/api/admin/gems",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/admin/gems/route.ts",nextConfigOutput:"",userland:j}),{workAsyncStorage:b,workUnitAsyncStorage:C,serverHooks:P}=q;function k(){return(0,s.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:C})}async function T(e,t,s){var R;let h="/api/admin/gems/route";h=h.replace(/\/index$/,"")||"/";let x=await q.prepare(e,t,{srcPage:h,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:v,params:w,nextConfig:_,isDraftMode:E,prerenderManifest:A,routerServerContext:N,isOnDemandRevalidate:j,revalidateOnlyGenerated:b,resolvedPathname:C}=x,P=(0,n.normalizeAppPath)(h),k=!!(A.dynamicRoutes[P]||A.routes[C]);if(k&&!E){let e=!!A.routes[C],t=A.dynamicRoutes[P];if(t&&!1===t.fallback&&!e)throw new f.NoFallbackError}let T=null;!k||q.isDev||E||(T="/index"===(T=C)?"/":T);let F=!0===q.isDev||!k,U=k&&!F,I=e.method||"GET",O=(0,a.getTracer)(),$=O.getActiveScopeSpan(),H={params:w,prerenderManifest:A,renderOpts:{experimental:{cacheComponents:!!_.experimental.cacheComponents,authInterrupts:!!_.experimental.authInterrupts},supportsDynamicResponse:F,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(R=_.experimental)?void 0:R.cacheLife,isRevalidate:U,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,s)=>q.onRequestError(e,t,s,N)},sharedContext:{buildId:v}},S=new o.NodeNextRequest(e),G=new o.NodeNextResponse(t),D=d.NextRequestAdapter.fromNodeNextRequest(S,(0,d.signalFromNodeResponse)(t));try{let n=async r=>q.handle(D,H).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let s=O.getRootSpanAttributes();if(!s)return;if(s.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${s.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=s.get("next.route");if(i){let e=`${I} ${i}`;r.setAttributes({"next.route":i,"http.route":i,"next.span_name":e}),r.updateName(e)}else r.updateName(`${I} ${e.url}`)}),o=async a=>{var o,d;let u=async({previousCacheEntry:r})=>{try{if(!(0,i.getRequestMeta)(e,"minimalMode")&&j&&b&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await n(a);e.fetchMetrics=H.renderOpts.fetchMetrics;let d=H.renderOpts.pendingWaitUntil;d&&s.waitUntil&&(s.waitUntil(d),d=void 0);let u=H.renderOpts.collectedTags;if(!k)return await (0,c.sendResponse)(S,G,o,H.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(o.headers);u&&(t[g.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,s=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==r?void 0:r.isStale)&&await q.onRequestError(e,t,{routerKind:"App Router",routePath:h,routeType:"route",revalidateReason:(0,l.getRevalidateReason)({isRevalidate:U,isOnDemandRevalidate:j})},N),t}},f=await q.handleResponse({req:e,nextConfig:_,cacheKey:T,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:j,revalidateOnlyGenerated:b,responseGenerator:u,waitUntil:s.waitUntil});if(!k)return null;if((null==f||null==(o=f.value)?void 0:o.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==f||null==(d=f.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,i.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",j?"REVALIDATED":f.isMiss?"MISS":f.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let R=(0,p.fromNodeOutgoingHttpHeaders)(f.value.headers);return(0,i.getRequestMeta)(e,"minimalMode")&&k||R.delete(g.NEXT_CACHE_TAGS_HEADER),!f.cacheControl||t.getHeader("Cache-Control")||R.get("Cache-Control")||R.set("Cache-Control",(0,m.getCacheControlHeader)(f.cacheControl)),await (0,c.sendResponse)(S,G,new Response(f.value.body,{headers:R,status:f.value.status||200})),null};$?await o($):await O.withPropagatedContext(e.headers,()=>O.trace(u.BaseServerSpan.handleRequest,{spanName:`${I} ${e.url}`,kind:a.SpanKind.SERVER,attributes:{"http.method":I,"http.target":e.url}},o))}catch(t){if($||t instanceof f.NoFallbackError||await q.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,l.getRevalidateReason)({isRevalidate:U,isOnDemandRevalidate:j})}),k)throw t;return await (0,c.sendResponse)(S,G,new Response(null,{status:500})),null}}},36145,e=>{e.v(e=>Promise.resolve().then(()=>e(2808)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__85ab9c07._.js.map