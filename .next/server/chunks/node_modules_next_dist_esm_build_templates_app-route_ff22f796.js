module.exports=[6046,e=>{"use strict";e.s(["handler",()=>P,"patchFetch",()=>O,"routeModule",()=>U,"serverHooks",()=>k,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>S],6046);var t=e.i(47909),r=e.i(74017),a=e.i(96250),s=e.i(59756),n=e.i(61916),i=e.i(69741),o=e.i(16795),l=e.i(87718),u=e.i(95169),d=e.i(47587),c=e.i(66012),p=e.i(70101),m=e.i(26937),R=e.i(10372),h=e.i(93695);e.i(52474);var f=e.i(5232);e.s(["DELETE",()=>j,"GET",()=>_,"POST",()=>I,"PUT",()=>C],61362);var g=e.i(89171);e.i(94879);var w=e.i(87022),v=e.i(3848),x=e.i(89209),y=e.i(38339),E=e.i(72783),N=e.i(48606);async function _(e){let t=(0,w.createServerClient)("https://xtqwqrnongwhiukntlkn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh0cXdxcm5vbmd3aGl1a250bGtuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1NjE0NjgsImV4cCI6MjA3NzEzNzQ2OH0.A0n5EqdcPdeZOghE-s6-BGha8x087kcG_mJitmUBYqU",{cookies:{get:t=>e.cookies.get(t)?.value,set(){},remove(){}}}),{data:{user:r}}=await t.auth.getUser();if(!r)return g.NextResponse.json({error:"Unauthorized"},{status:401});let a=(0,v.getRepositoryFactory)(t).getUserRepository(),s=await a.findById(r.id);if(!s||!["SuperAdmin","Admin","Moderator","superadmin","admin","moderator"].includes(s.role))return g.NextResponse.json({error:"Forbidden"},{status:403});let n=new URL(e.url).searchParams.get("q")||"",i=(await a.searchUsers(n,50)).map(e=>({id:e.id,email:e.email,first_name:e.first_name,last_name:e.last_name,role:e.role,is_active:e.is_active,two_factor_enabled:e.two_factor_enabled,last_login:e.last_login,created_at:e.created_at,updated_at:e.updated_at}));return g.NextResponse.json({users:i})}async function I(e){let t=(0,y.getRateLimitIdentifier)(e);if(!(await y.rateLimiters.api(t)).success)return g.NextResponse.json({error:"Too many requests. Please try again later."},{status:429});let r=(0,w.createServerClient)("https://xtqwqrnongwhiukntlkn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh0cXdxcm5vbmd3aGl1a250bGtuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1NjE0NjgsImV4cCI6MjA3NzEzNzQ2OH0.A0n5EqdcPdeZOghE-s6-BGha8x087kcG_mJitmUBYqU",{cookies:{get:t=>e.cookies.get(t)?.value,set(){},remove(){}}}),{data:{user:a}}=await r.auth.getUser();if(!a)return g.NextResponse.json({error:"Unauthorized"},{status:401});let s=(0,v.getRepositoryFactory)(r).getUserRepository(),n=await s.findById(a.id);if(!n||!["SuperAdmin","Admin","superadmin","admin"].includes(n.role))return g.NextResponse.json({error:"Forbidden"},{status:403});let i=(0,N.enforceCsrf)(e);if(!i.ok)return g.NextResponse.json({error:i.error},{status:403});let o=await (0,N.getAdminClient)(e),l=(0,v.getRepositoryFactory)(o).getUserRepository(),u=await e.json(),{email:d,firstName:c,lastName:p,role:m,password:R}=u||{},h=(0,E.validateInput)(u,[{field:"email",type:"email",required:!0},{field:"firstName",type:"string",required:!0},{field:"lastName",type:"string",required:!0},{field:"password",type:"string",required:!0},{field:"role",type:"string",required:!1}]);if(!h.valid)return g.NextResponse.json({error:`Validation failed: ${h.errors.map(e=>e.message).join(", ")}`},{status:400});if("superadmin"===m)return g.NextResponse.json({error:"SuperAdmin accounts can only be created through authorized scripts"},{status:403});if(m&&!["admin","moderator","user"].includes(m))return g.NextResponse.json({error:"Invalid role"},{status:400});let{isValid:f,errors:_}=(0,x.validatePasswordStrength)(R);if(!f)return g.NextResponse.json({error:_.join(", ")},{status:400});if(await l.findByEmail(d.toLowerCase()))return g.NextResponse.json({error:"Email already exists"},{status:400});try{let{data:e,error:t}=await o.auth.admin.createUser({email:d.toLowerCase(),password:R,email_confirm:!0,user_metadata:{first_name:c,last_name:p}});if(t||!e.user)return g.NextResponse.json({error:"Failed to create user account"},{status:500});let r=await l.create({id:e.user.id,email:d.toLowerCase(),password_hash:"",first_name:c,last_name:p,phone:"",role:m||"moderator",is_active:!0,is_verified:!0,two_factor_enabled:!1});return g.NextResponse.json({user:{id:r.id,email:r.email,first_name:r.first_name,last_name:r.last_name,role:r.role}})}catch(e){return g.NextResponse.json({error:"Internal server error"},{status:500})}}async function C(e){let t=(0,w.createServerClient)("https://xtqwqrnongwhiukntlkn.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{cookies:{get:t=>e.cookies.get(t)?.value,set(){},remove(){}}}),{data:{user:r}}=await t.auth.getUser();if(!r)return g.NextResponse.json({error:"Unauthorized"},{status:401});let a=(0,v.getRepositoryFactory)(t).getUserRepository(),s=await a.findById(r.id);if(!s||!["SuperAdmin","Admin","superadmin","admin"].includes(s.role))return g.NextResponse.json({error:"Forbidden"},{status:403});let n=(0,N.enforceCsrf)(e);if(!n.ok)return g.NextResponse.json({error:n.error},{status:403});let{id:i,role:o,isActive:l,resetPassword:u}=await e.json();if(!await a.findById(i))return g.NextResponse.json({error:"User not found"},{status:404});let d={};if("boolean"==typeof l&&(d.is_active=l),o&&(d.role=o),u){let{isValid:e,errors:r}=(0,x.validatePasswordStrength)(u);if(!e)return g.NextResponse.json({error:r.join(", ")},{status:400});let{error:a}=await t.auth.admin.updateUserById(i,{password:u});if(a)return g.NextResponse.json({error:"Failed to update password"},{status:500})}return Object.keys(d).length>0&&await a.updateProfile(i,d),g.NextResponse.json({success:!0})}async function j(e){let t=(0,w.createServerClient)("https://xtqwqrnongwhiukntlkn.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{cookies:{get:t=>e.cookies.get(t)?.value,set(){},remove(){}}}),{data:{user:r}}=await t.auth.getUser();if(!r)return g.NextResponse.json({error:"Unauthorized"},{status:401});let a=(0,v.getRepositoryFactory)(t).getUserRepository(),s=await a.findById(r.id);if(!s||!["SuperAdmin","Admin","superadmin","admin"].includes(s.role))return g.NextResponse.json({error:"Forbidden"},{status:403});let n=(0,N.enforceCsrf)(e);if(!n.ok)return g.NextResponse.json({error:n.error},{status:403});let i=new URL(e.url).searchParams.get("id");if(!i)return g.NextResponse.json({error:"Missing id"},{status:400});try{let{error:e}=await t.auth.admin.deleteUser(i);return await a.delete(i),g.NextResponse.json({success:!0})}catch(e){return g.NextResponse.json({error:"Internal server error"},{status:500})}}var A=e.i(61362);let U=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/admin/users/route",pathname:"/api/admin/users",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/admin/users/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:b,workUnitAsyncStorage:S,serverHooks:k}=U;function O(){return(0,a.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:S})}async function P(e,t,a){var g;let w="/api/admin/users/route";w=w.replace(/\/index$/,"")||"/";let v=await U.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:x,params:y,nextConfig:E,isDraftMode:N,prerenderManifest:_,routerServerContext:I,isOnDemandRevalidate:C,revalidateOnlyGenerated:j,resolvedPathname:A}=v,b=(0,i.normalizeAppPath)(w),S=!!(_.dynamicRoutes[b]||_.routes[A]);if(S&&!N){let e=!!_.routes[A],t=_.dynamicRoutes[b];if(t&&!1===t.fallback&&!e)throw new h.NoFallbackError}let k=null;!S||U.isDev||N||(k="/index"===(k=A)?"/":k);let O=!0===U.isDev||!S,P=S&&!O,q=e.method||"GET",T=(0,n.getTracer)(),F=T.getActiveScopeSpan(),B={params:y,prerenderManifest:_,renderOpts:{experimental:{cacheComponents:!!E.experimental.cacheComponents,authInterrupts:!!E.experimental.authInterrupts},supportsDynamicResponse:O,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(g=E.experimental)?void 0:g.cacheLife,isRevalidate:P,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>U.onRequestError(e,t,a,I)},sharedContext:{buildId:x}},M=new o.NodeNextRequest(e),H=new o.NodeNextResponse(t),z=l.NextRequestAdapter.fromNodeNextRequest(M,(0,l.signalFromNodeResponse)(t));try{let i=async r=>U.handle(z,B).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=T.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=a.get("next.route");if(s){let e=`${q} ${s}`;r.setAttributes({"next.route":s,"http.route":s,"next.span_name":e}),r.updateName(e)}else r.updateName(`${q} ${e.url}`)}),o=async n=>{var o,l;let u=async({previousCacheEntry:r})=>{try{if(!(0,s.getRequestMeta)(e,"minimalMode")&&C&&j&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(n);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=B.renderOpts.collectedTags;if(!S)return await (0,c.sendResponse)(M,H,o,B.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(o.headers);u&&(t[R.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await U.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isRevalidate:P,isOnDemandRevalidate:C})},I),t}},h=await U.handleResponse({req:e,nextConfig:E,cacheKey:k,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:_,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:j,responseGenerator:u,waitUntil:a.waitUntil});if(!S)return null;if((null==h||null==(o=h.value)?void 0:o.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==h||null==(l=h.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,s.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",C?"REVALIDATED":h.isMiss?"MISS":h.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,p.fromNodeOutgoingHttpHeaders)(h.value.headers);return(0,s.getRequestMeta)(e,"minimalMode")&&S||g.delete(R.NEXT_CACHE_TAGS_HEADER),!h.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,m.getCacheControlHeader)(h.cacheControl)),await (0,c.sendResponse)(M,H,new Response(h.value.body,{headers:g,status:h.value.status||200})),null};F?await o(F):await T.withPropagatedContext(e.headers,()=>T.trace(u.BaseServerSpan.handleRequest,{spanName:`${q} ${e.url}`,kind:n.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},o))}catch(t){if(t instanceof h.NoFallbackError||await U.onRequestError(e,t,{routerKind:"App Router",routePath:b,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isRevalidate:P,isOnDemandRevalidate:C})}),S)throw t;return await (0,c.sendResponse)(M,H,new Response(null,{status:500})),null}}}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_ff22f796.js.map